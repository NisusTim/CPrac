/*
 * coefs.c
 *
 *  Created on: Feb 16, 2019
 *      Author: erichu
 */

#include "sys_shared.h"
#include "SPT.h"
#include "windows.h"
#include "coefs.h"

/************************************************************************************************
 * Windowing
 ************************************************************************************************/

static void cheby_win(double *out, int N, float atten);
static void hamming_win(double *out, int N, float alpha);

window_context_t win_ctxs[WIN_TYPE_INVALID] = {
		{.proc=hamming_win,.name="hamming"},
		{.proc=cheby_win,.name="cheby"}};

static uint16_t zero_angle_calibration_bw = ZERO_CALIBRATION_BW;    //store the specified zero calibration bandwidth variable.

int8_t set_calibration_bandwidth(uint16_t bandwidth)    //set zero angle calibration used bandwidth.
{
	if(bandwidth <= 0 || bandwidth > 2000)    //range must between 1MHz - 2000MHz.
		return -1;
	zero_angle_calibration_bw = bandwidth;    //store zero calibration bandwidth value.
	return 0;
}

uint16_t get_calibration_bandwidth(void)    //get zero angle calibration used bandwidth.
{
	return zero_angle_calibration_bw;
}

static int16_t win_orders(int16_t N, int16_t idx)
{
	int16_t continus = N>>4, x;
	int16_t minor = idx&(continus-1);
	int16_t base = (idx-minor)>>1;
	if(idx & continus)
		base = base + (N>>1) - (continus>>1);
	x = base + minor;

	continus = N>>3;
	minor = (x%continus)*8;
	base = x/continus + minor;
//	PRINTF("wodrs:%d->%d->%d\n", idx,x, base);
	return base;
}

/**************************************************************************
calculate a hamming window of size N
***************************************************************************/
void blackman_window(double* out, int N, float alpha)
{
    double f;
    float a0 = (1-alpha)/2;
    float a1 = 0.5f;
    float a2 = alpha/2;

    for (int i=0; i<N; i++){
    	f = (2*PI*i)/(N-1);
        out[win_orders(N,i)] = a0 - a1*cos(f) + a2*cos(2*f);
    }
}

/**************************************************************************
This function computes the chebyshev polyomial T_n(x)
***************************************************************************/
static double cheby_poly(int n, double x)
{
    double res;
    if (fabs(x) <= 1)
    	res = cos(n*acos(x));
    else
    	res = cosh(n*acosh(x));
    return res;
}

/***************************************************************************
 calculate a chebyshev window of size N, store coeffs in out as in Antoniou
-out should be array of size N
-atten is the required sidelobe attenuation (e.g. if you want -60dB atten, use '60')
***************************************************************************/
void cheby_win(double *out, int N, float atten)
{
    int16_t nn, i, xx;
    double M, n, sum = 0, max=0;
    double tg = pow(10,atten/20);  // 1/r term [2], 10^gamma [2]
    double x0 = cosh((1.0/(N-1))*acosh(tg));
    M = (N-1)/2;
    if(N%2==0) M = M + 0.5; // handle even length windows
    for(nn=0; nn<(N/2+1); nn++){
        n = nn-M;
        sum = 0;
        for(i=1; i<=M; i++){
            sum += cheby_poly(N-1,x0*cos(PI*i/N))*cos(2.0*n*PI*i/N);
        }
        xx = win_orders(N,nn);
        out[xx] = tg + 2*sum;
        out[win_orders(N,N-nn-1)] = out[xx];
        if(out[xx]>max)max=out[xx];

#ifdef ENABLE_SWT
        clear_SWT0_counter();
#endif
		fs8x_wd_handle(fs8xNormal);

    }
    for(nn=0; nn<N; nn++) out[nn] /= max; // normalise everything
    return;
}

/**************************************************************************
calculate a hamming window of size N
***************************************************************************/
void hamming_win(double *out, int N, float alpha)
{
	double omega = 2.0 * PI / (N-1);

	if (alpha <= 0.0 || alpha >= 1.0)
		alpha = 0.54;

	if(!out)
		return;

	for (int16_t i=0;i<N;i++)
		out[win_orders(N,i)] = alpha - (1-alpha) * cos(omega*i);
}

window_context_p window_ctx_get(WIN_TYPE_E type)
{
	if(type < WIN_TYPE_INVALID)
		return &win_ctxs[type];
	return 0;
}

void null_win(double *out, int N, float alpha)
{
	int count = 0;
	while(count < N){
		out[count] = 1;
		count++;
	}
}

void window_get(WIN_TYPE_E type, int N, void *out, int8_t factor)
{
	switch(type) {
	case WIN_TYPE_NONE:
		null_win(out, N, 0);
		break;
	case WIN_TYPE_HAMMING :
		hamming_win(out, N, (float)factor/100);
		break;
	case WIN_TYPE_CHEBY:
		cheby_win(out, N, (float)factor);
		break;
	case WIN_TYPE_BLACKMAN:
		blackman_window(out, N, (float)factor/100);
		break;
	default:
		return;
	}
}


#ifdef AOAIDXS_SET
/************************************************************************************************
 * calculating idx of aoa fft to asin(), sin(), and cos() values
 ************************************************************************************************/
void coefs_aoa_idxs_set(aoaidxs_table_p tables)
{
	for(int idx=0; idx < BINS_OF_AOA_FFT; idx++){
		tables->asin[idx] = ASIN((idx-(BINS_OF_AOA_FFT/2)/(BINS_OF_AOA_FFT/2)));
		tables->sin[idx] = SIN(tables->asin[idx]);
		tables->cos[idx] = COS(tables->asin[idx]);
	}
}
#endif

const aoaidxs_table_t aoaidxs_table = {
		.asin={ -1.5707963267948966,-1.5082861497959064,-1.4823791815804472,-1.4624902235184059,-1.4457148032019138,-1.4309280952736882,-1.4175533172987804,-1.4052478901213101,
				-1.3937886405068656,-1.3830205765798635,-1.3728308675952428,-1.363134348866811,-1.3538648662553876,-1.344969819025637,-1.3364065652938748,-1.328139967432275,
				-1.3201406644587659,-1.3123838243976498,-1.304848223052125,-1.2975155505182108,-1.2903698801933186,-1.2833972560361602,-1.2765853674030105,-1.2699232897676995,
				-1.2634012757103932,-1.2570105847539743,-1.2507433435723354,-1.2445924301972102,-1.2385513773728343,-1.232614291325484,-1.2267757830456387,-1.2210309098049623,
				-1.2153751251046732,-1.209804235615782,-1.204314363953406,-1.1989019163473282,-1.1935635544440883,-1.18829617061314,-1.1830968662392092,-1.1779629325710717,
				-1.1728918337682062,-1.1678811918447243,-1.1629287732573943,-1.1580324769235528,-1.1531903234869172,-1.1484004456760664,-1.1436610796226714,-1.138970557025255,
				-1.1343272980599775,-1.12972980495323,-1.1251766561420737,-1.120666500958129,-1.1161980547786983,-1.1117700945959057,-1.1073814549606387,-1.1030310242632713,
				-1.098717741317612,-1.094440592218409,-1.0901986074461123,-1.0859908591955247,-1.0818164589075494,-1.0776745549854727,-1.0735643306792066,-1.069485002122635,
				-1.0654358165107394,-1.0614160504045336,-1.0574250081530234,-1.053462020422467,-1.0495264428241564,-1.0456176546327742,-1.0417350575881243,-1.037878074773704,
				-1.0340461495661852,-1.030238744650397,-1.0264553410948904,-1.0226954374835946,-1.01895854909946,-1.015244207156336,-1.011551958075646,-1.0078813628047099,
				-1.0042319961738184,-1.0006034462894042,-0.9969953139608615,-0.9934072121587655,-0.9898387655024116,-0.9862896097747612,-0.9827593914630246,-0.979247767323242,
				-0.9757544039673527,-0.972278977471345,-0.9688211730031908,-0.9653806844693555,-0.9619572141787629,-0.9585504725231746,-0.9551601776730139,-0.9517860552877317,
				-0.948427838239876,-0.9450852663520777,-0.9417580861462252,-0.938446050604143,-0.9351489189391351,-0.9318664563777992,-0.928598433951551,-0.9253446282973372,
				-0.9221048214670461,-0.9188788007451572,-0.915666358474199,-0.9124672918876091,-0.9092814029496191,-0.9061084982018035,-0.9029483886159604,-0.8998008894530054,
				-0.8966658201275814,-0.8935430040781056,-0.8904322686419863,-0.8873334449357642,-0.884246367739939,-0.8811708753882629,-0.8781068096612881,-0.8750540156839732,
				-0.8720123418271584,-0.8689816396127343,-0.8659617636223357,-0.8629525714094011,-0.8599539234144497,-0.8569656828834297,-0.8539877157890072,-0.8510198907546633,
				-0.848062078981481,-0.8451141541775047,-0.8421759924895633,-0.8392474724374528,-0.8363284748503788,-0.8334188828055655,-0.830518581568942,-0.8276274585378187,
				-0.8247454031854757,-0.821872307007583,-0.8190080634703816,-0.8161525679605532,-0.8133057177367133,-0.810467411882463,-0.8076375512609385,-0.8048160384708025,
				-0.8020027778036185,-0.7991976752025578,-0.7964006382223892,-0.7936115759906993,-0.790830399170303,-0.788057019922794,-0.7852913518731984,-0.7825333100756877,
				-0.7797828109803135,-0.7770397724007279,-0.7743041134828521,-0.771575754674462,-0.7688546176956561,-0.766140625510175,-0.7634337022975441,-0.7607337734260088,
				-0.758040765426236,-0.7553546059657557,-0.7526752238241168,-0.7500025488687329,-0.7473365120313951,-0.7446770452854299,-0.7420240816234789,-0.7393775550358822,
				-0.7367374004896439,-0.7341035539079603,-0.731475952150295,-0.7288545329929796,-0.726239235110326,-0.7236299980562327,-0.72102676224627,-0.7184294689402275,
				-0.7158380602251112,-0.7132524789985757,-0.7106726689527763,-0.7080985745586309,-0.7055301410504765,-0.7029673144111097,-0.7004100413571991,-0.6978582693250581,
				-0.6953119464567681,-0.6927710215866406,-0.6902354442280088,-0.687705164560338,-0.6851801334166482,-0.6826603022712346,-0.6801456232276836,-0.67763604900717,
				-0.6751315329370317,-0.6726320289396108,-0.6701374915213564,-0.6676478757621778,-0.6651631373050455,-0.6626832323458298,-0.6602081176233716,-0.6577377504097789,
				-0.6552720885009422,-0.6528110902072637,-0.650354714344594,-0.6479029202253701,-0.6454556676499499,-0.6430129168981381,-0.6405746287208975,-0.6381407643322413,
				-0.6357112854013022,-0.6332861540445713,-0.6308653328183067,-0.6284487847111009,-0.6260364731366106,-0.6236283619264369,-0.6212244153231591,-0.6188245979735119,
				-0.6164288749217072,-0.6140372116028943,-0.611649573836755,-0.6092659278212315,-0.6068862401263823,-0.604510477688364,-0.6021386078035355,-0.5997705981226811,
				-0.5974064166453502,-0.5950460317143107,-0.5926894120101127,-0.5903365265457602,-0.5879873446614887,-0.5856418360196451,-0.5832999705996688,-0.5809617186931689,
				-0.5786270508990996,-0.576295938119027,-0.5739683515524875,-0.5716442626924358,-0.5693236433207793,-0.5670064655039972,-0.5646927015888432,-0.5623823241981278,
				-0.560075306226582,-0.557771620836796,-0.5554712414552349,-0.5531741417683268,-0.5508802957186253,-0.5485896775010398,-0.5463022615591369,-0.5440180225815077,
				-0.541736935498202,-0.5394589754772262,-0.5371841179211043,-0.534912338463501,-0.5326436129659039,-0.5303779175143664,-0.5281152284163058,-0.5258555221973602,
				-0.5235987755982989,-0.5213449655719874,-0.5190940692804052,-0.5168460640917151,-0.5146009275773826,-0.5123586375093466,-0.510119171857236,-0.5078825087856352,
				-0.5056486266513965,-0.5034175040009967,-0.5011891195679387,-0.4989634522701967,-0.4967404812077047,-0.4945201856598855,-0.4923025450832217,-0.4900875391088663,
				-0.48787514754029293,-0.485665350350984,-0.4834581276821573,-0.48125345984052875,-0.47905132729611205,-0.4768517106800532,-0.47465459078250033,-0.47245994855050716,
				-0.47026776508597007,-0.4680780216435978,-0.46589069962891333,-0.46370578059628725,-0.46152324624700164,-0.4593430784273448,-0.45716525912673484,-0.4549897704758731,
				-0.4528165947449256,-0.4506457143417326,-0.4484771118100457,-0.4463107698277915,-0.4441466712053621,-0.44198479888393105,-0.4398251359337951,-0.4376676655527404,
				-0.43551237106443375,-0.4333592359168373,-0.4312082436806467,-0.4290593780477533,-0.4269126228297277,-0.42476796195632655,-0.42262537947402057,-0.4204848595445447,
				-0.4183463864434681,-0.4162099445587865,-0.41407551838953305,-0.41194309254441025,-0.4098126517404412,-0.4076841808016396,-0.4055576646576992,-0.40343308834270125,
				-0.4013104369938405,-0.39918969585016884,-0.3970708502513563,-0.3949538856364698,-0.39283878754276835,-0.390725541604515,-0.38861413355180496,-0.3865045492094102,
				-0.3843967744956391,-0.38229079542121236,-0.3801865980881535,-0.37808416868869454,-0.3759834935041962,-0.37388455890408295,-0.37178735134479163,-0.36969185736873456,
				-0.3675980636032758,-0.36550595675972136,-0.36341552363232243,-0.3613267510972914,-0.35923962611183097,-0.3571541357131758,-0.35507026701764605,-0.3529880072197139,
				-0.3509073435910811,-0.34882826347976903,-0.3467507543092194,-0.34467480357740743,-0.3426003988559651,-0.3405275277893161,-0.33845617809382117,-0.3363863375569341,
				-0.3343179940363684,-0.332251135459274,-0.3301857498214239,-0.3281218251864112,-0.32605934968485534,-0.3239983115136184,-0.32193869893503047,-0.31988050027612464,
				-0.31782370392788073,-0.3157682983444785,-0.3137142720425591,-0.3116616136004958,-0.30961031165767294,-0.30756035491377315,-0.3055117321280734,-0.3034644321187486,
				-0.30141844376218346,-0.2993737559922923,-0.2973303577998468,-0.29528823823181055,-0.2932473863906822,-0.2912077914338453,-0.28916944257292565,-0.2871323290731557,
				-0.2850964402527462,-0.2830617654822644,-0.2810282941840196,-0.2789960158314547,-0.27696491994854544,-0.27493499610920463,-0.2729062339366944,-0.27087862310304334,
				-0.26885215332847107,-0.2668268143808177,-0.2648025960749803,-0.2627794882723548,-0.2607574808802837,-0.25873656385150967,-0.25671672718363453,-0.2546979609185842,
				-0.25268025514207865,-0.25066359998310755,-0.24864798561341095,-0.24663340224696548,-0.24461984013947533,-0.24260728958786848,-0.24059574092979785,-0.23858518454314742,
				-0.2365756108455429,-0.23456701029386745,-0.2325593733837818,-0.23055269064924924,-0.2285469526620647,-0.22654215003138883,-0.22453827340328586,-0.22253531346026625,
				-0.22053326092083333,-0.21853210653903407,-0.21653184110401422,-0.21453245543957714,-0.21253394040374687,-0.21053628688833506,-0.2085394858185116,-0.20654352815237917,
				-0.20454840488055165,-0.20255410702573584,-0.20056062564231714,-0.19856795181594858,-0.19657607666314347,-0.19458499133087137,-0.19259468699615756,-0.19060515486568574,
				-0.1886163861754041,-0.18662837219013453,-0.1846411042031851,-0.18265457353596556,-0.18066877153760597,-0.17868368958457834,-0.1766993190803212,-0.17471565145486717,
				-0.17273267816447335,-0.1707503906912545,-0.16876878054281913,-0.16678783925190815,-0.16480755837603633,-0.1628279294971364,-0.16084894422120558,-0.158870594177955,
				-0.1568928710204612,-0.15491576642482055,-0.15293927208980562,-0.15096337973652438,-0.14898808110808143,-0.14701336796924164,-0.1450392321060961,-0.14306566532573017,
				-0.1410926594558939,-0.13912020634467417,-0.13714829786016966,-0.1351769258901671,-0.13320608234182008,-0.13123575914132954,-0.12926594823362644,-0.1272966415820563,
				-0.1253278311680654,-0.1233595089908891,-0.12139166706724183,-0.11942429743100894,-0.11745739213294011,-0.11549094324034473,-0.11352494283678867,-0.11155938302179295,
				-0.1095942559105338,-0.10762955363354446,-0.10566526833641832,-0.10370139217951384,-0.10173791733766063,-0.0997748359998673,-0.09781214036903041,-0.09584982266164502,
				-0.09388787510751648,-0.0919262899494736,-0.0899650594430831,-0.08800417585636519,-0.08604363146951062,-0.08408341857459872,-0.08212352947531672,-0.08016395648668012,
				-0.07820469193475428,-0.07624572815637704,-0.07428705749888233,-0.07232867231982493,-0.07037056498670617,-0.06841272787670054,-0.06645515337638333,-0.06449783388145916,
				-0.06254076179649139,-0.06058392953463235,-0.05862732951735447,-0.056670954174182206,-0.0547147959424247,-0.05275884726690921,-0.05080310059971531,-0.048847548399909714,
				-0.04689218313328187,-0.04493699727208008,-0.042981983294748366,-0.041027133685663845,-0.03907244093487471,-0.03711789753783876,-0.035163495995162414,-0.033209228812340286,
				-0.031255088499495154,-0.029301067571118413,-0.02734715854581095,-0.025393353946024388,-0.02343964629780272,-0.02148602813052429,-0.019532491976644056,-0.017579030371436197,
				-0.01562563585273695,-0.013672300960687719,-0.011719018237478385,-0.009765780227090818,-0.007812579475042568,-0.005859408528130682,-0.003906259934175676,-0.0019531262417655645,
				0.0,0.0019531262417655645,0.003906259934175676,0.005859408528130682,0.007812579475042568,0.009765780227090818,0.011719018237478385,0.013672300960687719,
				0.01562563585273695,0.017579030371436197,0.019532491976644056,0.02148602813052429,0.02343964629780272,0.025393353946024388,0.02734715854581095,0.029301067571118413,
				0.031255088499495154,0.033209228812340286,0.035163495995162414,0.03711789753783876,0.03907244093487471,0.041027133685663845,0.042981983294748366,0.04493699727208008,
				0.04689218313328187,0.048847548399909714,0.05080310059971531,0.05275884726690921,0.0547147959424247,0.056670954174182206,0.05862732951735447,0.06058392953463235,
				0.06254076179649139,0.06449783388145916,0.06645515337638333,0.06841272787670054,0.07037056498670617,0.07232867231982493,0.07428705749888233,0.07624572815637704,
				0.07820469193475428,0.08016395648668012,0.08212352947531672,0.08408341857459872,0.08604363146951062,0.08800417585636519,0.0899650594430831,0.0919262899494736,
				0.09388787510751648,0.09584982266164502,0.09781214036903041,0.0997748359998673,0.10173791733766063,0.10370139217951384,0.10566526833641832,0.10762955363354446,
				0.1095942559105338,0.11155938302179295,0.11352494283678867,0.11549094324034473,0.11745739213294011,0.11942429743100894,0.12139166706724183,0.1233595089908891,
				0.1253278311680654,0.1272966415820563,0.12926594823362644,0.13123575914132954,0.13320608234182008,0.1351769258901671,0.13714829786016966,0.13912020634467417,
				0.1410926594558939,0.14306566532573017,0.1450392321060961,0.14701336796924164,0.14898808110808143,0.15096337973652438,0.15293927208980562,0.15491576642482055,
				0.1568928710204612,0.158870594177955,0.16084894422120558,0.1628279294971364,0.16480755837603633,0.16678783925190815,0.16876878054281913,0.1707503906912545,
				0.17273267816447335,0.17471565145486717,0.1766993190803212,0.17868368958457834,0.18066877153760597,0.18265457353596556,0.1846411042031851,0.18662837219013453,
				0.1886163861754041,0.19060515486568574,0.19259468699615756,0.19458499133087137,0.19657607666314347,0.19856795181594858,0.20056062564231714,0.20255410702573584,
				0.20454840488055165,0.20654352815237917,0.2085394858185116,0.21053628688833506,0.21253394040374687,0.21453245543957714,0.21653184110401422,0.21853210653903407,
				0.22053326092083333,0.22253531346026625,0.22453827340328586,0.22654215003138883,0.2285469526620647,0.23055269064924924,0.2325593733837818,0.23456701029386745,
				0.2365756108455429,0.23858518454314742,0.24059574092979785,0.24260728958786848,0.24461984013947533,0.24663340224696548,0.24864798561341095,0.25066359998310755,
				0.25268025514207865,0.2546979609185842,0.25671672718363453,0.25873656385150967,0.2607574808802837,0.2627794882723548,0.2648025960749803,0.2668268143808177,
				0.26885215332847107,0.27087862310304334,0.2729062339366944,0.27493499610920463,0.27696491994854544,0.2789960158314547,0.2810282941840196,0.2830617654822644,
				0.2850964402527462,0.2871323290731557,0.28916944257292565,0.2912077914338453,0.2932473863906822,0.29528823823181055,0.2973303577998468,0.2993737559922923,
				0.30141844376218346,0.3034644321187486,0.3055117321280734,0.30756035491377315,0.30961031165767294,0.3116616136004958,0.3137142720425591,0.3157682983444785,
				0.31782370392788073,0.31988050027612464,0.32193869893503047,0.3239983115136184,0.32605934968485534,0.3281218251864112,0.3301857498214239,0.332251135459274,
				0.3343179940363684,0.3363863375569341,0.33845617809382117,0.3405275277893161,0.3426003988559651,0.34467480357740743,0.3467507543092194,0.34882826347976903,
				0.3509073435910811,0.3529880072197139,0.35507026701764605,0.3571541357131758,0.35923962611183097,0.3613267510972914,0.36341552363232243,0.36550595675972136,
				0.3675980636032758,0.36969185736873456,0.37178735134479163,0.37388455890408295,0.3759834935041962,0.37808416868869454,0.3801865980881535,0.38229079542121236,
				0.3843967744956391,0.3865045492094102,0.38861413355180496,0.390725541604515,0.39283878754276835,0.3949538856364698,0.3970708502513563,0.39918969585016884,
				0.4013104369938405,0.40343308834270125,0.4055576646576992,0.4076841808016396,0.4098126517404412,0.41194309254441025,0.41407551838953305,0.4162099445587865,
				0.4183463864434681,0.4204848595445447,0.42262537947402057,0.42476796195632655,0.4269126228297277,0.4290593780477533,0.4312082436806467,0.4333592359168373,
				0.43551237106443375,0.4376676655527404,0.4398251359337951,0.44198479888393105,0.4441466712053621,0.4463107698277915,0.4484771118100457,0.4506457143417326,
				0.4528165947449256,0.4549897704758731,0.45716525912673484,0.4593430784273448,0.46152324624700164,0.46370578059628725,0.46589069962891333,0.4680780216435978,
				0.47026776508597007,0.47245994855050716,0.47465459078250033,0.4768517106800532,0.47905132729611205,0.48125345984052875,0.4834581276821573,0.485665350350984,
				0.48787514754029293,0.4900875391088663,0.4923025450832217,0.4945201856598855,0.4967404812077047,0.4989634522701967,0.5011891195679387,0.5034175040009967,
				0.5056486266513965,0.5078825087856352,0.510119171857236,0.5123586375093466,0.5146009275773826,0.5168460640917151,0.5190940692804052,0.5213449655719874,
				0.5235987755982989,0.5258555221973602,0.5281152284163058,0.5303779175143664,0.5326436129659039,0.534912338463501,0.5371841179211043,0.5394589754772262,
				0.541736935498202,0.5440180225815077,0.5463022615591369,0.5485896775010398,0.5508802957186253,0.5531741417683268,0.5554712414552349,0.557771620836796,
				0.560075306226582,0.5623823241981278,0.5646927015888432,0.5670064655039972,0.5693236433207793,0.5716442626924358,0.5739683515524875,0.576295938119027,
				0.5786270508990996,0.5809617186931689,0.5832999705996688,0.5856418360196451,0.5879873446614887,0.5903365265457602,0.5926894120101127,0.5950460317143107,
				0.5974064166453502,0.5997705981226811,0.6021386078035355,0.604510477688364,0.6068862401263823,0.6092659278212315,0.611649573836755,0.6140372116028943,
				0.6164288749217072,0.6188245979735119,0.6212244153231591,0.6236283619264369,0.6260364731366106,0.6284487847111009,0.6308653328183067,0.6332861540445713,
				0.6357112854013022,0.6381407643322413,0.6405746287208975,0.6430129168981381,0.6454556676499499,0.6479029202253701,0.650354714344594,0.6528110902072637,
				0.6552720885009422,0.6577377504097789,0.6602081176233716,0.6626832323458298,0.6651631373050455,0.6676478757621778,0.6701374915213564,0.6726320289396108,
				0.6751315329370317,0.67763604900717,0.6801456232276836,0.6826603022712346,0.6851801334166482,0.687705164560338,0.6902354442280088,0.6927710215866406,
				0.6953119464567681,0.6978582693250581,0.7004100413571991,0.7029673144111097,0.7055301410504765,0.7080985745586309,0.7106726689527763,0.7132524789985757,
				0.7158380602251112,0.7184294689402275,0.72102676224627,0.7236299980562327,0.726239235110326,0.7288545329929796,0.731475952150295,0.7341035539079603,
				0.7367374004896439,0.7393775550358822,0.7420240816234789,0.7446770452854299,0.7473365120313951,0.7500025488687329,0.7526752238241168,0.7553546059657557,
				0.758040765426236,0.7607337734260088,0.7634337022975441,0.766140625510175,0.7688546176956561,0.771575754674462,0.7743041134828521,0.7770397724007279,
				0.7797828109803135,0.7825333100756877,0.7852913518731984,0.788057019922794,0.790830399170303,0.7936115759906993,0.7964006382223892,0.7991976752025578,
				0.8020027778036185,0.8048160384708025,0.8076375512609385,0.810467411882463,0.8133057177367133,0.8161525679605532,0.8190080634703816,0.821872307007583,
				0.8247454031854757,0.8276274585378187,0.830518581568942,0.8334188828055655,0.8363284748503788,0.8392474724374528,0.8421759924895633,0.8451141541775047,
				0.848062078981481,0.8510198907546633,0.8539877157890072,0.8569656828834297,0.8599539234144497,0.8629525714094011,0.8659617636223357,0.8689816396127343,
				0.8720123418271584,0.8750540156839732,0.8781068096612881,0.8811708753882629,0.884246367739939,0.8873334449357642,0.8904322686419863,0.8935430040781056,
				0.8966658201275814,0.8998008894530054,0.9029483886159604,0.9061084982018035,0.9092814029496191,0.9124672918876091,0.915666358474199,0.9188788007451572,
				0.9221048214670461,0.9253446282973372,0.928598433951551,0.9318664563777992,0.9351489189391351,0.938446050604143,0.9417580861462252,0.9450852663520777,
				0.948427838239876,0.9517860552877317,0.9551601776730139,0.9585504725231746,0.9619572141787629,0.9653806844693555,0.9688211730031908,0.972278977471345,
				0.9757544039673527,0.979247767323242,0.9827593914630246,0.9862896097747612,0.9898387655024116,0.9934072121587655,0.9969953139608615,1.0006034462894042,
				1.0042319961738184,1.0078813628047099,1.011551958075646,1.015244207156336,1.01895854909946,1.0226954374835946,1.0264553410948904,1.030238744650397,
				1.0340461495661852,1.037878074773704,1.0417350575881243,1.0456176546327742,1.0495264428241564,1.053462020422467,1.0574250081530234,1.0614160504045336,
				1.0654358165107394,1.069485002122635,1.0735643306792066,1.0776745549854727,1.0818164589075494,1.0859908591955247,1.0901986074461123,1.094440592218409,
				1.098717741317612,1.1030310242632713,1.1073814549606387,1.1117700945959057,1.1161980547786983,1.120666500958129,1.1251766561420737,1.12972980495323,
				1.1343272980599775,1.138970557025255,1.1436610796226714,1.1484004456760664,1.1531903234869172,1.1580324769235528,1.1629287732573943,1.1678811918447243,
				1.1728918337682062,1.1779629325710717,1.1830968662392092,1.18829617061314,1.1935635544440883,1.1989019163473282,1.204314363953406,1.209804235615782,
				1.2153751251046732,1.2210309098049623,1.2267757830456387,1.232614291325484,1.2385513773728343,1.2445924301972102,1.2507433435723354,1.2570105847539743,
				1.2634012757103932,1.2699232897676995,1.2765853674030105,1.2833972560361602,1.2903698801933186,1.2975155505182108,1.304848223052125,1.3123838243976498,
				1.3201406644587659,1.328139967432275,1.3364065652938748,1.344969819025637,1.3538648662553876,1.363134348866811,1.3728308675952428,1.3830205765798635,
				1.3937886405068656,1.4052478901213101,1.4175533172987804,1.4309280952736882,1.4457148032019138,1.4624902235184059,1.4823791815804472,1.5082861497959064,
				PI		// INVALID_AOAIDX
		},
		.sin={	-1.0,-0.998046875,-0.99609375,-0.994140625,-0.9921875,-0.990234375,-0.98828125,-0.986328125,
				-0.984375,-0.982421875,-0.98046875,-0.978515625,-0.9765625,-0.974609375,-0.97265625,-0.970703125,
				-0.96875,-0.966796875,-0.96484375,-0.962890625,-0.9609375,-0.958984375,-0.95703125,-0.955078125,
				-0.953125,-0.951171875,-0.94921875,-0.947265625,-0.9453125,-0.943359375,-0.94140625,-0.939453125,
				-0.9375,-0.935546875,-0.93359375,-0.931640625,-0.9296875,-0.927734375,-0.92578125,-0.923828125,
				-0.921875,-0.919921875,-0.91796875,-0.916015625,-0.9140625,-0.912109375,-0.91015625,-0.908203125,
				-0.90625,-0.904296875,-0.90234375,-0.900390625,-0.8984375,-0.896484375,-0.89453125,-0.892578125,
				-0.890625,-0.8886718750000001,-0.88671875,-0.8847656249999999,-0.8828125,-0.880859375,-0.87890625,-0.876953125,
				-0.875,-0.873046875,-0.87109375,-0.869140625,-0.8671875,-0.865234375,-0.86328125,-0.861328125,
				-0.859375,-0.857421875,-0.85546875,-0.853515625,-0.8515625,-0.849609375,-0.84765625,-0.845703125,
				-0.84375,-0.841796875,-0.83984375,-0.837890625,-0.8359375,-0.833984375,-0.83203125,-0.830078125,
				-0.828125,-0.826171875,-0.82421875,-0.822265625,-0.8203125,-0.818359375,-0.81640625,-0.814453125,
				-0.8125,-0.810546875,-0.80859375,-0.806640625,-0.8046875,-0.802734375,-0.80078125,-0.798828125,
				-0.796875,-0.794921875,-0.79296875,-0.791015625,-0.7890625,-0.787109375,-0.78515625,-0.783203125,
				-0.78125,-0.779296875,-0.77734375,-0.775390625,-0.7734375,-0.771484375,-0.76953125,-0.767578125,
				-0.765625,-0.763671875,-0.76171875,-0.759765625,-0.7578125,-0.755859375,-0.75390625,-0.751953125,
				-0.75,-0.748046875,-0.74609375,-0.744140625,-0.7421875,-0.740234375,-0.73828125,-0.736328125,
				-0.734375,-0.732421875,-0.73046875,-0.728515625,-0.7265625,-0.724609375,-0.72265625,-0.720703125,
				-0.71875,-0.716796875,-0.71484375,-0.712890625,-0.7109375,-0.708984375,-0.70703125,-0.705078125,
				-0.703125,-0.701171875,-0.69921875,-0.697265625,-0.6953125,-0.693359375,-0.69140625,-0.689453125,
				-0.6875,-0.685546875,-0.68359375,-0.681640625,-0.6796874999999999,-0.677734375,-0.67578125,-0.673828125,
				-0.671875,-0.669921875,-0.66796875,-0.666015625,-0.6640625,-0.662109375,-0.66015625,-0.658203125,
				-0.65625,-0.654296875,-0.65234375,-0.650390625,-0.6484375,-0.646484375,-0.64453125,-0.642578125,
				-0.640625,-0.638671875,-0.63671875,-0.634765625,-0.6328125,-0.630859375,-0.62890625,-0.626953125,
				-0.625,-0.623046875,-0.62109375,-0.619140625,-0.6171875,-0.615234375,-0.61328125,-0.611328125,
				-0.609375,-0.607421875,-0.60546875,-0.603515625,-0.6015625,-0.599609375,-0.59765625,-0.595703125,
				-0.59375,-0.591796875,-0.58984375,-0.5878906249999999,-0.5859375,-0.583984375,-0.58203125,-0.580078125,
				-0.578125,-0.576171875,-0.57421875,-0.572265625,-0.5703125,-0.568359375,-0.56640625,-0.564453125,
				-0.5625,-0.5605468749999999,-0.55859375,-0.556640625,-0.5546875,-0.5527343749999999,-0.55078125,-0.548828125,
				-0.5468749999999999,-0.544921875,-0.54296875,-0.541015625,-0.5390624999999999,-0.5371093749999999,-0.5351562500000001,-0.533203125,
				-0.53125,-0.5292968749999999,-0.52734375,-0.525390625,-0.5234375,-0.521484375,-0.51953125,-0.517578125,
				-0.515625,-0.513671875,-0.51171875,-0.509765625,-0.5078125,-0.505859375,-0.50390625,-0.501953125,
				-0.5,-0.49804687499999994,-0.49609375,-0.494140625,-0.49218749999999994,-0.49023437499999994,-0.48828125000000006,-0.486328125,
				-0.484375,-0.482421875,-0.48046875,-0.478515625,-0.4765625,-0.474609375,-0.47265625,-0.470703125,
				-0.46875,-0.466796875,-0.46484375,-0.462890625,-0.4609375,-0.458984375,-0.45703125,-0.455078125,
				-0.453125,-0.451171875,-0.44921875,-0.447265625,-0.4453125,-0.443359375,-0.44140625,-0.439453125,
				-0.4375,-0.435546875,-0.43359375,-0.431640625,-0.4296875,-0.427734375,-0.42578125,-0.423828125,
				-0.421875,-0.419921875,-0.41796875,-0.416015625,-0.4140625,-0.412109375,-0.41015625,-0.408203125,
				-0.40625,-0.404296875,-0.40234375,-0.400390625,-0.3984375,-0.396484375,-0.39453125,-0.392578125,
				-0.390625,-0.388671875,-0.38671875,-0.384765625,-0.3828125,-0.380859375,-0.37890625,-0.376953125,
				-0.375,-0.373046875,-0.37109375,-0.369140625,-0.3671875,-0.365234375,-0.36328125,-0.361328125,
				-0.359375,-0.357421875,-0.35546875,-0.353515625,-0.3515625,-0.349609375,-0.34765625,-0.345703125,
				-0.34375,-0.341796875,-0.33984375,-0.337890625,-0.3359375,-0.333984375,-0.33203125,-0.330078125,
				-0.328125,-0.326171875,-0.32421875,-0.322265625,-0.3203125,-0.318359375,-0.31640625,-0.314453125,
				-0.3125,-0.310546875,-0.30859375,-0.306640625,-0.3046875,-0.302734375,-0.30078125,-0.298828125,
				-0.296875,-0.294921875,-0.29296875,-0.291015625,-0.2890625,-0.287109375,-0.28515625,-0.283203125,
				-0.28125,-0.279296875,-0.27734375,-0.275390625,-0.2734375,-0.271484375,-0.26953125,-0.267578125,
				-0.265625,-0.263671875,-0.26171875,-0.259765625,-0.2578125,-0.255859375,-0.25390625,-0.251953125,
				-0.25,-0.24804687500000003,-0.24609375,-0.244140625,-0.2421875,-0.240234375,-0.23828125,-0.236328125,
				-0.234375,-0.232421875,-0.23046875,-0.228515625,-0.2265625,-0.224609375,-0.22265625,-0.220703125,
				-0.21875,-0.216796875,-0.21484375,-0.212890625,-0.2109375,-0.208984375,-0.20703125,-0.205078125,
				-0.203125,-0.201171875,-0.19921875,-0.197265625,-0.1953125,-0.193359375,-0.19140625,-0.189453125,
				-0.1875,-0.185546875,-0.18359375,-0.181640625,-0.1796875,-0.177734375,-0.17578125,-0.173828125,
				-0.171875,-0.169921875,-0.16796875,-0.166015625,-0.1640625,-0.162109375,-0.16015625,-0.158203125,
				-0.15625,-0.154296875,-0.15234375,-0.150390625,-0.1484375,-0.146484375,-0.14453125,-0.142578125,
				-0.140625,-0.138671875,-0.13671875,-0.134765625,-0.1328125,-0.130859375,-0.12890625,-0.126953125,
				-0.125,-0.123046875,-0.12109375,-0.119140625,-0.1171875,-0.115234375,-0.11328125,-0.111328125,
				-0.109375,-0.107421875,-0.10546875,-0.103515625,-0.1015625,-0.099609375,-0.09765625,-0.095703125,
				-0.09375,-0.091796875,-0.08984375,-0.087890625,-0.0859375,-0.083984375,-0.08203125,-0.080078125,
				-0.078125,-0.076171875,-0.07421875,-0.072265625,-0.0703125,-0.068359375,-0.06640625,-0.064453125,
				-0.06249999999999999,-0.060546875,-0.05859375,-0.056640625,-0.0546875,-0.052734375,-0.05078125,-0.048828125,
				-0.046875,-0.044921875,-0.04296875,-0.041015625,-0.0390625,-0.037109375,-0.03515625,-0.033203125,
				-0.03125,-0.029296875,-0.02734375,-0.025390625,-0.0234375,-0.021484375,-0.01953125,-0.017578125,
				-0.015625,-0.013671875,-0.01171875,-0.009765625,-0.0078125,-0.005859375,-0.00390625,-0.001953125,
				0.0,0.001953125,0.00390625,0.005859375,0.0078125,0.009765625,0.01171875,0.013671875,
				0.015625,0.017578125,0.01953125,0.021484375,0.0234375,0.025390625,0.02734375,0.029296875,
				0.03125,0.033203125,0.03515625,0.037109375,0.0390625,0.041015625,0.04296875,0.044921875,
				0.046875,0.048828125,0.05078125,0.052734375,0.0546875,0.056640625,0.05859375,0.060546875,
				0.06249999999999999,0.064453125,0.06640625,0.068359375,0.0703125,0.072265625,0.07421875,0.076171875,
				0.078125,0.080078125,0.08203125,0.083984375,0.0859375,0.087890625,0.08984375,0.091796875,
				0.09375,0.095703125,0.09765625,0.099609375,0.1015625,0.103515625,0.10546875,0.107421875,
				0.109375,0.111328125,0.11328125,0.115234375,0.1171875,0.119140625,0.12109375,0.123046875,
				0.125,0.126953125,0.12890625,0.130859375,0.1328125,0.134765625,0.13671875,0.138671875,
				0.140625,0.142578125,0.14453125,0.146484375,0.1484375,0.150390625,0.15234375,0.154296875,
				0.15625,0.158203125,0.16015625,0.162109375,0.1640625,0.166015625,0.16796875,0.169921875,
				0.171875,0.173828125,0.17578125,0.177734375,0.1796875,0.181640625,0.18359375,0.185546875,
				0.1875,0.189453125,0.19140625,0.193359375,0.1953125,0.197265625,0.19921875,0.201171875,
				0.203125,0.205078125,0.20703125,0.208984375,0.2109375,0.212890625,0.21484375,0.216796875,
				0.21875,0.220703125,0.22265625,0.224609375,0.2265625,0.228515625,0.23046875,0.232421875,
				0.234375,0.236328125,0.23828125,0.240234375,0.2421875,0.244140625,0.24609375,0.24804687500000003,
				0.25,0.251953125,0.25390625,0.255859375,0.2578125,0.259765625,0.26171875,0.263671875,
				0.265625,0.267578125,0.26953125,0.271484375,0.2734375,0.275390625,0.27734375,0.279296875,
				0.28125,0.283203125,0.28515625,0.287109375,0.2890625,0.291015625,0.29296875,0.294921875,
				0.296875,0.298828125,0.30078125,0.302734375,0.3046875,0.306640625,0.30859375,0.310546875,
				0.3125,0.314453125,0.31640625,0.318359375,0.3203125,0.322265625,0.32421875,0.326171875,
				0.328125,0.330078125,0.33203125,0.333984375,0.3359375,0.337890625,0.33984375,0.341796875,
				0.34375,0.345703125,0.34765625,0.349609375,0.3515625,0.353515625,0.35546875,0.357421875,
				0.359375,0.361328125,0.36328125,0.365234375,0.3671875,0.369140625,0.37109375,0.373046875,
				0.375,0.376953125,0.37890625,0.380859375,0.3828125,0.384765625,0.38671875,0.388671875,
				0.390625,0.392578125,0.39453125,0.396484375,0.3984375,0.400390625,0.40234375,0.404296875,
				0.40625,0.408203125,0.41015625,0.412109375,0.4140625,0.416015625,0.41796875,0.419921875,
				0.421875,0.423828125,0.42578125,0.427734375,0.4296875,0.431640625,0.43359375,0.435546875,
				0.4375,0.439453125,0.44140625,0.443359375,0.4453125,0.447265625,0.44921875,0.451171875,
				0.453125,0.455078125,0.45703125,0.458984375,0.4609375,0.462890625,0.46484375,0.466796875,
				0.46875,0.470703125,0.47265625,0.474609375,0.4765625,0.478515625,0.48046875,0.482421875,
				0.484375,0.486328125,0.48828125000000006,0.49023437499999994,0.49218749999999994,0.494140625,0.49609375,0.49804687499999994,
				0.5,0.501953125,0.50390625,0.505859375,0.5078125,0.509765625,0.51171875,0.513671875,
				0.515625,0.517578125,0.51953125,0.521484375,0.5234375,0.525390625,0.52734375,0.5292968749999999,
				0.53125,0.533203125,0.5351562500000001,0.5371093749999999,0.5390624999999999,0.541015625,0.54296875,0.544921875,
				0.5468749999999999,0.548828125,0.55078125,0.5527343749999999,0.5546875,0.556640625,0.55859375,0.5605468749999999,
				0.5625,0.564453125,0.56640625,0.568359375,0.5703125,0.572265625,0.57421875,0.576171875,
				0.578125,0.580078125,0.58203125,0.583984375,0.5859375,0.5878906249999999,0.58984375,0.591796875,
				0.59375,0.595703125,0.59765625,0.599609375,0.6015625,0.603515625,0.60546875,0.607421875,
				0.609375,0.611328125,0.61328125,0.615234375,0.6171875,0.619140625,0.62109375,0.623046875,
				0.625,0.626953125,0.62890625,0.630859375,0.6328125,0.634765625,0.63671875,0.638671875,
				0.640625,0.642578125,0.64453125,0.646484375,0.6484375,0.650390625,0.65234375,0.654296875,
				0.65625,0.658203125,0.66015625,0.662109375,0.6640625,0.666015625,0.66796875,0.669921875,
				0.671875,0.673828125,0.67578125,0.677734375,0.6796874999999999,0.681640625,0.68359375,0.685546875,
				0.6875,0.689453125,0.69140625,0.693359375,0.6953125,0.697265625,0.69921875,0.701171875,
				0.703125,0.705078125,0.70703125,0.708984375,0.7109375,0.712890625,0.71484375,0.716796875,
				0.71875,0.720703125,0.72265625,0.724609375,0.7265625,0.728515625,0.73046875,0.732421875,
				0.734375,0.736328125,0.73828125,0.740234375,0.7421875,0.744140625,0.74609375,0.748046875,
				0.75,0.751953125,0.75390625,0.755859375,0.7578125,0.759765625,0.76171875,0.763671875,
				0.765625,0.767578125,0.76953125,0.771484375,0.7734375,0.775390625,0.77734375,0.779296875,
				0.78125,0.783203125,0.78515625,0.787109375,0.7890625,0.791015625,0.79296875,0.794921875,
				0.796875,0.798828125,0.80078125,0.802734375,0.8046875,0.806640625,0.80859375,0.810546875,
				0.8125,0.814453125,0.81640625,0.818359375,0.8203125,0.822265625,0.82421875,0.826171875,
				0.828125,0.830078125,0.83203125,0.833984375,0.8359375,0.837890625,0.83984375,0.841796875,
				0.84375,0.845703125,0.84765625,0.849609375,0.8515625,0.853515625,0.85546875,0.857421875,
				0.859375,0.861328125,0.86328125,0.865234375,0.8671875,0.869140625,0.87109375,0.873046875,
				0.875,0.876953125,0.87890625,0.880859375,0.8828125,0.8847656249999999,0.88671875,0.8886718750000001,
				0.890625,0.892578125,0.89453125,0.896484375,0.8984375,0.900390625,0.90234375,0.904296875,
				0.90625,0.908203125,0.91015625,0.912109375,0.9140625,0.916015625,0.91796875,0.919921875,
				0.921875,0.923828125,0.92578125,0.927734375,0.9296875,0.931640625,0.93359375,0.935546875,
				0.9375,0.939453125,0.94140625,0.943359375,0.9453125,0.947265625,0.94921875,0.951171875,
				0.953125,0.955078125,0.95703125,0.958984375,0.9609375,0.962890625,0.96484375,0.966796875,
				0.96875,0.970703125,0.97265625,0.974609375,0.9765625,0.978515625,0.98046875,0.982421875,
				0.984375,0.986328125,0.98828125,0.990234375,0.9921875,0.994140625,0.99609375,0.998046875
		},
		.cos={6.123233995736766e-17,0.06246947496765415,0.08830198871451023,0.10809448517204448,0.12475562048961965,0.13941263417767918,0.15264393502015564,0.16479329426279565,
				0.1760848073372602,0.1866742068993047,0.1966749355495953,0.20617267430690062,0.21523402053056126,0.22391196073928107,0.232249476503043,0.24028200747295755,
				0.24803918541230532,0.25554608682238594,0.262824158109443,0.269891912229895,0.27676546224872417,0.28345893618981094,0.28998480395261655,0.2963541380620227,
				0.30257682392245455,0.3086617310406075,0.3146168537259844,0.3204494276689526,0.32616602726793914,0.3317726474554667,0.33727477293882724,0.34267743714422505,
				0.34798527267687634,0.3532025547440652,0.3583332387051716,0.3633809926917055,0.36834922606644643,0.37324111435285284,0.37805962115576086,0.3828075175058405,
				0.38748739898866397,0.39210170096096797,0.3966527121090154,0.4011425865647518,0.4055733547630441,0.40994693319637027,0.4142651332008735,0.4185296688888786,
				0.4227421643271463,0.4269041600467654,0.4310171189592561,0.4350824317438126,0.4391014217623874,0.44307534955226224,0.44700541693970286,0.4508927708130664,
				0.45473850658922643,0.4585436714032637,0.4623092670479767,0.46603625268680493,0.46972554736116917,0.47337803231097375,0.47699455312502004,0.48057592173634167,
				0.48412291827592707,0.4876362927969312,0.49111676688027817,0.4945650351314873,0.4979817665776027,0.501367605972264,0.5047231750162038,0.5080490734997796,
				0.5113458803735492,0.5146141547523584,0.5178544368579239,0.521067248904457,0.5242530959314881,0.5274124665876881,0.5305458338691742,0.5336536558154872,
				0.5367363761661772,0.5397944249806905,0.5428282192240355,0.5458381633205115,0.5488246496776088,0.5517880591820191,0.5547287616695545,0.5576471163706349,
				0.560543472332878,0.5634181688222207,0.5662715357038861,0.5691038938044259,0.5719155552559748,0.5747068238237731,0.5774779952179455,0.5802293573904498,
				0.582961190818051,0.5856737687721163,0.5883673575759769,0.5910422168505474,0.5936985997488541,0.5963367531800797,0.5989569180236902,0.6015593293341766,
				0.6041442165369126,0.6067118036155917,0.6092623092916856,0.6117959471963339,0.6143129260350542,0.6168134497456337,0.6192977176495466,0.6217659245972188,
				0.624218261107443,0.6266549135012303,0.6290760640303663,0.6314818910009292,0.6338725688920053,0.636248268469832,0.6386091568975797,0.6409553978409764,
				0.6432871515699657,0.6456045750565778,0.6479078220691872,0.6501970432633167,0.6524723862691432,0.654733995775849,0.6569820136129584,0.65921657882879,
				0.6614378277661477,0.6636458941353698,0.6658409090848485,0.6680230012691251,0.6701922969146616,0.6723489198833886,0.6744929917341155,0.6766246317818946,
				0.678743957155421,0.6808510828525459,0.6829461217939797,0.6850291848752572,0.6871003810170315,0.6891598172137645,0.6912075985808732,0.6932438284003937,
				0.6952686081652184,0.6972820376219614,0.699284214812502,0.7012752361142588,0.7032551962792384,0.7052241884719067,0.7071823043059248,0.7091296338797896,
				0.7110662658114222,0.7129922872717379,0.7149077840172378,0.7168128404216538,0.7187075395066828,0.7205919629718398,0.7224661912234631,0.7243303034028981,
				0.7261843774138906,0.7280284899492151,0.7298627165165635,0.7316871314637216,0.7335018080030546,0.7353068182353264,0.7371022331728737,0.738888122762157,
				0.7406645559057082,0.7424316004834953,0.7441893233737216,0.7459377904730792,0.7476770667164736,0.7494072160962352,0.7511283016808363,0.7528403856331263,
				0.7545435292281023,0.7562377928702283,0.7579232361103184,0.7595999176619949,0.7612678954177367,0.7629272264645295,0.7645779670991295,0.7662201728429527,
				0.7678538984566009,0.7694791979540346,0.7710961246164044,0.77270473100555,0.7743050689771764,0.775897189693718,0.7774811436368971,0.7790569806199893,
				0.7806247497997998,0.7821844996883628,0.7837362781643692,0.7852801324843316,0.786816109293493,0.7883442546364877,0.7898646139677594,0.7913772321617449,
				0.7928821535228296,0.7943794217950793,0.7958690801717563,0.7973511713046262,0.7988257373130576,0.8002928197929239,0.8017524598253113,0.8032046979850369,
				0.8046495743489833,0.8060871285042545,0.8075173995561566,0.80894042613601,0.8103562464087939,0.8117648980806323,0.8131664184061203,0.8145608441954992,
				0.8159482118216818,0.8173285572271315,0.8187019159306014,0.8200683230337332,0.8214278132275228,0.8227804207986535,0.8241261796357021,0.8254651232352185,
				0.8267972847076845,0.8281226967833537,0.8294413918179738,0.8307534017983973,0.8320587583480809,0.8333574927324764,0.8346496358643174,0.835935218308802,
				0.8372142702886759,0.8384868216892167,0.8397529020631233,0.8410125406353103,0.8422657663076127,0.8435126076634003,0.8447530929721048,0.8459872501936624,
				0.8472151069828725,0.8484366906936748,0.849652028383348,0.8508611468166292,0.8520640724697586,0.853260831534449,0.8544514499217831,0.8556359532660397,
				0.8568143669284497,0.8579867160008856,0.8591530253094832,0.8603133194181986,0.8614676226323018,0.8626159590018082,0.8637583523248487,0.8648948261509802,
				0.8660254037844386,0.8671501082873336,0.8682689624827883,0.8693819889580238,0.8704892100673908,0.8715906479353478,0.8726863244593888,0.8737762613129201,
				0.8748604799480887,0.8759390015985613,0.8770118472822573,0.8780790378040347,0.8791405937583305,0.880196535531758,0.8812468833056588,0.8822916570586137,
				0.8833308765689106,0.8843645614169726,0.8853927309877451,0.8864154044730436,0.8874326008738636,0.8884443390026521,0.8894506374855422,0.8904515147645515,
				0.8914469890997445,0.8924370785713603,0.8934218010819064,0.894401174358218,0.895375215953485,0.896343943249247,0.8973073734573552,0.8982655236219046,
				0.899218410621135,0.9001660511693019,0.9011084618185191,0.9020456589605702,0.9029776588286944,0.9039044774993426,0.9048261308939068,0.9057426347804239,
				0.9066540047752505,0.9075602563447147,0.9084614048067411,0.9093574653324508,0.9102484529477378,0.9111343825348209,0.912015268833772,0.9128911264440215,
				0.9137619698258403,0.9146278133018011,0.9154886710582155,0.9163445571465514,0.9171954854848283,0.9180414698589925,0.9188825239242705,0.9197186612065041,
				0.9205498951034647,0.9213762388861482,0.9221977057000508,0.923014308566427,0.9238260603835281,0.9246329739278225,0.9254350618551999,0.9262323367021551,
				0.9270248108869579,0.9278124967108033,0.9285954063589468,0.9293735519018224,0.9301469452961452,0.9309155983859972,0.9316795229038993,0.9324387304718655,
				0.9331932326024445,0.9339430406997444,0.9346881660604447,0.9354286198747926,0.9361644132275858,0.9368955570991407,0.9376220623662487,0.9383439398031163,
				0.939061200082295,0.9397738537755955,0.9404819113549912,0.9411853831935074,0.9418842795660993,0.9425786106505173,0.9432683865281596,0.9439536171849147,
				0.94463431251199,0.945310482306731,0.9459821362734274,0.9466492840241096,0.9473119350793328,0.9479700988689513,0.9486237847328821,0.9492730019218573,
				0.9499177595981665,0.9505580668363898,0.9511939326241192,0.951825365862672,0.9524523753677924,0.9530749698703452,0.9536931580169995,0.9543069483709025,
				0.9549163494123452,0.9555213695394177,0.9561220170686572,0.9567183002356856,0.9573102271958396,0.9578978060247917,0.9584810447191626,0.9590599511971264,
				0.9596345332990055,0.9602047987878598,0.9607707553500666,0.9613324105958924,0.9618897720600578,0.9624428472022946,0.9629916434078946,0.9635361679882517,
				0.9640764281813968,0.9646124311525248,0.9651441839945146,0.9656716937284427,0.9661949673040892,0.9667140116004368,0.9672288334261637,0.9677394395201295,
				0.9682458365518543,0.9687480311219911,0.9692460297627933,0.969739838938573,0.9702294650461559,0.970714914415329,0.9711961933092806,0.9716733079250374,
				0.9721462643938925,0.9726150687818302,0.9730797270899427,0.9735402452548427,0.9739966291490695,0.9744488845814897,0.9748970172976926,0.9753410329803799,
				0.9757809372497497,0.9762167356638762,0.9766484337190827,0.9770760368503105,0.9774995504314823,0.9779189797758603,0.9783343301363995,0.9787456067060962,
				0.9791528146183311,0.979555958947208,0.9799550447078873,0.9803500768569151,0.9807410602925474,0.9811279998550696,0.9815109003271117,0.9818897664339589,
				0.982264602843857,0.9826354141683142,0.9830022049623985,0.9833649797250303,0.9837237428992704,0.9840784988726049,0.9844292519772244,0.9847760064903005,
				0.9851187666342571,0.985457536577038,0.9857923204323705,0.9861231222600245,0.9864499460660687,0.9867727958031217,0.9870916753705997,0.9874065886149608,
				0.9877175393299442,0.9880245312568076,0.9883275680845585,0.9886266534501835,0.988921790938874,0.9892129840842463,0.9895002363685607,0.989783551222935,
				0.9900629320275555,0.9903383821118842,0.9906099047548623,0.9908775031851108,0.9911411805811269,0.9914009400714775,0.9916567847349896,0.9919087176009365,
				0.9921567416492215,0.9924008598105578,0.9926410749666454,0.9928773899503449,0.9931098075458473,0.9933383304888418,0.993562961466679,0.9937837031185329,
				0.9940005580355576,0.9942135287610425,0.9944226177905637,0.9946278275721323,0.9948291605063404,0.995026618946503,0.995220205198798,0.9954099215224019,
				0.9955957701296244,0.9957777531860382,0.9959558728106067,0.9961301310758095,0.9963005300077633,0.9964670715863416,0.9966297577452911,0.9967885903723439,
				0.9969435713093294,0.9970947023522813,0.9972419852515424,0.9973854217118673,0.9975250133925214,0.9976607619073777,0.9977926688250107,0.9979207356687877,
				0.998044963916957,0.9981653550027342,0.9982819103143848,0.9983946311953051,0.9985035189440996,0.9986085748146565,0.9987098000162197,0.9988071957134592,
				0.9989007630265381,0.9989905030311772,0.999076416758717,0.9991585051961772,0.9992367692863139,0.9993112099276729,0.9993818279746423,0.9994486242375015,
				0.9995115994824673,0.9995707544317383,0.9996260897635363,0.9996776061121452,0.9997253040679475,0.9997691841774577,0.9998092469433545,0.9998454928245085,
				0.9998779222360098,0.9999065355491904,0.9999313330916466,0.9999523151472571,0.9999694819561995,0.999982833714964,0.9999923705763647,0.9999980926495482,
				1.0,0.9999980926495482,0.9999923705763647,0.999982833714964,0.9999694819561995,0.9999523151472571,0.9999313330916466,0.9999065355491904,
				0.9998779222360098,0.9998454928245085,0.9998092469433545,0.9997691841774577,0.9997253040679475,0.9996776061121452,0.9996260897635363,0.9995707544317383,
				0.9995115994824673,0.9994486242375015,0.9993818279746423,0.9993112099276729,0.9992367692863139,0.9991585051961772,0.999076416758717,0.9989905030311772,
				0.9989007630265381,0.9988071957134592,0.9987098000162197,0.9986085748146565,0.9985035189440996,0.9983946311953051,0.9982819103143848,0.9981653550027342,
				0.998044963916957,0.9979207356687877,0.9977926688250107,0.9976607619073777,0.9975250133925214,0.9973854217118673,0.9972419852515424,0.9970947023522813,
				0.9969435713093294,0.9967885903723439,0.9966297577452911,0.9964670715863416,0.9963005300077633,0.9961301310758095,0.9959558728106067,0.9957777531860382,
				0.9955957701296244,0.9954099215224019,0.995220205198798,0.995026618946503,0.9948291605063404,0.9946278275721323,0.9944226177905637,0.9942135287610425,
				0.9940005580355576,0.9937837031185329,0.993562961466679,0.9933383304888418,0.9931098075458473,0.9928773899503449,0.9926410749666454,0.9924008598105578,
				0.9921567416492215,0.9919087176009365,0.9916567847349896,0.9914009400714775,0.9911411805811269,0.9908775031851108,0.9906099047548623,0.9903383821118842,
				0.9900629320275555,0.989783551222935,0.9895002363685607,0.9892129840842463,0.988921790938874,0.9886266534501835,0.9883275680845585,0.9880245312568076,
				0.9877175393299442,0.9874065886149608,0.9870916753705997,0.9867727958031217,0.9864499460660687,0.9861231222600245,0.9857923204323705,0.985457536577038,
				0.9851187666342571,0.9847760064903005,0.9844292519772244,0.9840784988726049,0.9837237428992704,0.9833649797250303,0.9830022049623985,0.9826354141683142,
				0.982264602843857,0.9818897664339589,0.9815109003271117,0.9811279998550696,0.9807410602925474,0.9803500768569151,0.9799550447078873,0.979555958947208,
				0.9791528146183311,0.9787456067060962,0.9783343301363995,0.9779189797758603,0.9774995504314823,0.9770760368503105,0.9766484337190827,0.9762167356638762,
				0.9757809372497497,0.9753410329803799,0.9748970172976926,0.9744488845814897,0.9739966291490695,0.9735402452548427,0.9730797270899427,0.9726150687818302,
				0.9721462643938925,0.9716733079250374,0.9711961933092806,0.970714914415329,0.9702294650461559,0.969739838938573,0.9692460297627933,0.9687480311219911,
				0.9682458365518543,0.9677394395201295,0.9672288334261637,0.9667140116004368,0.9661949673040892,0.9656716937284427,0.9651441839945146,0.9646124311525248,
				0.9640764281813968,0.9635361679882517,0.9629916434078946,0.9624428472022946,0.9618897720600578,0.9613324105958924,0.9607707553500666,0.9602047987878598,
				0.9596345332990055,0.9590599511971264,0.9584810447191626,0.9578978060247917,0.9573102271958396,0.9567183002356856,0.9561220170686572,0.9555213695394177,
				0.9549163494123452,0.9543069483709025,0.9536931580169995,0.9530749698703452,0.9524523753677924,0.951825365862672,0.9511939326241192,0.9505580668363898,
				0.9499177595981665,0.9492730019218573,0.9486237847328821,0.9479700988689513,0.9473119350793328,0.9466492840241096,0.9459821362734274,0.945310482306731,
				0.94463431251199,0.9439536171849147,0.9432683865281596,0.9425786106505173,0.9418842795660993,0.9411853831935074,0.9404819113549912,0.9397738537755955,
				0.939061200082295,0.9383439398031163,0.9376220623662487,0.9368955570991407,0.9361644132275858,0.9354286198747926,0.9346881660604447,0.9339430406997444,
				0.9331932326024445,0.9324387304718655,0.9316795229038993,0.9309155983859972,0.9301469452961452,0.9293735519018224,0.9285954063589468,0.9278124967108033,
				0.9270248108869579,0.9262323367021551,0.9254350618551999,0.9246329739278225,0.9238260603835281,0.923014308566427,0.9221977057000508,0.9213762388861482,
				0.9205498951034647,0.9197186612065041,0.9188825239242705,0.9180414698589925,0.9171954854848283,0.9163445571465514,0.9154886710582155,0.9146278133018011,
				0.9137619698258403,0.9128911264440215,0.912015268833772,0.9111343825348209,0.9102484529477378,0.9093574653324508,0.9084614048067411,0.9075602563447147,
				0.9066540047752505,0.9057426347804239,0.9048261308939068,0.9039044774993426,0.9029776588286944,0.9020456589605702,0.9011084618185191,0.9001660511693019,
				0.899218410621135,0.8982655236219046,0.8973073734573552,0.896343943249247,0.895375215953485,0.894401174358218,0.8934218010819064,0.8924370785713603,
				0.8914469890997445,0.8904515147645515,0.8894506374855422,0.8884443390026521,0.8874326008738636,0.8864154044730436,0.8853927309877451,0.8843645614169726,
				0.8833308765689106,0.8822916570586137,0.8812468833056588,0.880196535531758,0.8791405937583305,0.8780790378040347,0.8770118472822573,0.8759390015985613,
				0.8748604799480887,0.8737762613129201,0.8726863244593888,0.8715906479353478,0.8704892100673908,0.8693819889580238,0.8682689624827883,0.8671501082873336,
				0.8660254037844386,0.8648948261509802,0.8637583523248487,0.8626159590018082,0.8614676226323018,0.8603133194181986,0.8591530253094832,0.8579867160008856,
				0.8568143669284497,0.8556359532660397,0.8544514499217831,0.853260831534449,0.8520640724697586,0.8508611468166292,0.849652028383348,0.8484366906936748,
				0.8472151069828725,0.8459872501936624,0.8447530929721048,0.8435126076634003,0.8422657663076127,0.8410125406353103,0.8397529020631233,0.8384868216892167,
				0.8372142702886759,0.835935218308802,0.8346496358643174,0.8333574927324764,0.8320587583480809,0.8307534017983973,0.8294413918179738,0.8281226967833537,
				0.8267972847076845,0.8254651232352185,0.8241261796357021,0.8227804207986535,0.8214278132275228,0.8200683230337332,0.8187019159306014,0.8173285572271315,
				0.8159482118216818,0.8145608441954992,0.8131664184061203,0.8117648980806323,0.8103562464087939,0.80894042613601,0.8075173995561566,0.8060871285042545,
				0.8046495743489833,0.8032046979850369,0.8017524598253113,0.8002928197929239,0.7988257373130576,0.7973511713046262,0.7958690801717563,0.7943794217950793,
				0.7928821535228296,0.7913772321617449,0.7898646139677594,0.7883442546364877,0.786816109293493,0.7852801324843316,0.7837362781643692,0.7821844996883628,
				0.7806247497997998,0.7790569806199893,0.7774811436368971,0.775897189693718,0.7743050689771764,0.77270473100555,0.7710961246164044,0.7694791979540346,
				0.7678538984566009,0.7662201728429527,0.7645779670991295,0.7629272264645295,0.7612678954177367,0.7595999176619949,0.7579232361103184,0.7562377928702283,
				0.7545435292281023,0.7528403856331263,0.7511283016808363,0.7494072160962352,0.7476770667164736,0.7459377904730792,0.7441893233737216,0.7424316004834953,
				0.7406645559057082,0.738888122762157,0.7371022331728737,0.7353068182353264,0.7335018080030546,0.7316871314637216,0.7298627165165635,0.7280284899492151,
				0.7261843774138906,0.7243303034028981,0.7224661912234631,0.7205919629718398,0.7187075395066828,0.7168128404216538,0.7149077840172378,0.7129922872717379,
				0.7110662658114222,0.7091296338797896,0.7071823043059248,0.7052241884719067,0.7032551962792384,0.7012752361142588,0.699284214812502,0.6972820376219614,
				0.6952686081652184,0.6932438284003937,0.6912075985808732,0.6891598172137645,0.6871003810170315,0.6850291848752572,0.6829461217939797,0.6808510828525459,
				0.678743957155421,0.6766246317818946,0.6744929917341155,0.6723489198833886,0.6701922969146616,0.6680230012691251,0.6658409090848485,0.6636458941353698,
				0.6614378277661477,0.65921657882879,0.6569820136129584,0.654733995775849,0.6524723862691432,0.6501970432633167,0.6479078220691872,0.6456045750565778,
				0.6432871515699657,0.6409553978409764,0.6386091568975797,0.636248268469832,0.6338725688920053,0.6314818910009292,0.6290760640303663,0.6266549135012303,
				0.624218261107443,0.6217659245972188,0.6192977176495466,0.6168134497456337,0.6143129260350542,0.6117959471963339,0.6092623092916856,0.6067118036155917,
				0.6041442165369126,0.6015593293341766,0.5989569180236902,0.5963367531800797,0.5936985997488541,0.5910422168505474,0.5883673575759769,0.5856737687721163,
				0.582961190818051,0.5802293573904498,0.5774779952179455,0.5747068238237731,0.5719155552559748,0.5691038938044259,0.5662715357038861,0.5634181688222207,
				0.560543472332878,0.5576471163706349,0.5547287616695545,0.5517880591820191,0.5488246496776088,0.5458381633205115,0.5428282192240355,0.5397944249806905,
				0.5367363761661772,0.5336536558154872,0.5305458338691742,0.5274124665876881,0.5242530959314881,0.521067248904457,0.5178544368579239,0.5146141547523584,
				0.5113458803735492,0.5080490734997796,0.5047231750162038,0.501367605972264,0.4979817665776027,0.4945650351314873,0.49111676688027817,0.4876362927969312,
				0.48412291827592707,0.48057592173634167,0.47699455312502004,0.47337803231097375,0.46972554736116917,0.46603625268680493,0.4623092670479767,0.4585436714032637,
				0.45473850658922643,0.4508927708130664,0.44700541693970286,0.44307534955226224,0.4391014217623874,0.4350824317438126,0.4310171189592561,0.4269041600467654,
				0.4227421643271463,0.4185296688888786,0.4142651332008735,0.40994693319637027,0.4055733547630441,0.4011425865647518,0.3966527121090154,0.39210170096096797,
				0.38748739898866397,0.3828075175058405,0.37805962115576086,0.37324111435285284,0.36834922606644643,0.3633809926917055,0.3583332387051716,0.3532025547440652,
				0.34798527267687634,0.34267743714422505,0.33727477293882724,0.3317726474554667,0.32616602726793914,0.3204494276689526,0.3146168537259844,0.3086617310406075,
				0.30257682392245455,0.2963541380620227,0.28998480395261655,0.28345893618981094,0.27676546224872417,0.269891912229895,0.262824158109443,0.25554608682238594,
				0.24803918541230532,0.24028200747295755,0.232249476503043,0.22391196073928107,0.21523402053056126,0.20617267430690062,0.1966749355495953,0.1866742068993047,
				0.1760848073372602,0.16479329426279565,0.15264393502015564,0.13941263417767918,0.12475562048961965,0.10809448517204448,0.08830198871451023,0.06246947496765415
		},
};

float aoaidx_asin(int16_t idx) {return aoaidxs_table.asin[idx];}
float aoaidx_sin(int16_t idx) {return aoaidxs_table.sin[idx];}
float aoaidx_cos(int16_t idx) {return aoaidxs_table.cos[idx];}

rv_cmps_data_t	__attribute__((section(".rvcmps"))) rv_cmps_data;
/************************************************************************************************
 * Calibration start
 ************************************************************************************************/
const double_cmplx_t velo_cmps_negative[]={
		 {0.0, +1.0},									// -64
		 {0.024541228522912264,+0.99969881869620425},	// -63
		 {0.049067674327418126,+0.99879545620517241},	// -62
		 {0.073564563599667454,+0.99729045667869021},	// -61
		 {0.09801714032956077,+0.99518472667219682},	// -60
		 {0.12241067519921628,+0.99247953459870997},	// -59
		 {0.14673047445536175,+0.98917650996478101},	// -58
		 {0.17096188876030136,+0.98527764238894122},	// -57
		 {0.19509032201612833,+0.98078528040323043},	// -56
		 {0.21910124015686977,+0.97570213003852857},	// -55
		 {0.24298017990326398,+0.97003125319454397},	// -54
		 {0.26671275747489842,+0.96377606579543984},	// -53
		 {0.29028467725446233,+0.95694033573220894},	// -52
		 {0.31368174039889157,+0.94952818059303667},	// -51
		 {0.33688985339222005,+0.94154406518302081},	// -50
		 {0.35989503653498828,+0.93299279883473885},	// -49
		 {0.38268343236508984,+0.92387953251128674},	// -48
		 {0.40524131400498986,+0.91420975570353069},	// -47
		 {0.4275550934302822,+0.90398929312344334},		// -46
		 {0.4496113296546066,+0.89322430119551532},		// -45
		 {0.47139673682599781,+0.88192126434835494},	// -44
		 {0.49289819222978409,+0.87008699110871135},	// -43
		 {0.51410274419322166,+0.85772861000027212},	// -42
		 {0.53499761988709726,+0.84485356524970701},	// -41
		 {0.55557023301960229,+0.83146961230254524},	// -40
		 {0.57580819141784534,+0.81758481315158371},	// -39
		 {0.59569930449243347,+0.80320753148064483},	// -38
		 {0.61523159058062682,+0.78834642762660623},	// -37
		 {0.63439328416364549,+0.77301045336273688},	// -36
		 {0.65317284295377687,+0.75720884650648457},	// -35
		 {0.67155895484701833,+0.74095112535495911},	// -34
		 {0.68954054473706694,+0.72424708295146689},	// -33
		 {0.70710678118654757,+0.70710678118654757},	// -32
		 {0.724247082951467,+0.68954054473706683},		// -31
		 {0.74095112535495922,+0.67155895484701833},	// -30
		 {0.75720884650648457,+0.65317284295377676},	// -29
		 {0.77301045336273699,+0.63439328416364549},	// -28
		 {0.78834642762660623,+0.61523159058062682},	// -27
		 {0.80320753148064494,+0.59569930449243336},	// -26
		 {0.81758481315158371,+0.57580819141784534},	// -25
		 {0.83146961230254524,+0.55557023301960218},	// -24
		 {0.84485356524970712,+0.53499761988709715},	// -23
		 {0.85772861000027212,+0.51410274419322166},	// -22
		 {0.87008699110871146,+0.49289819222978404},	// -21
		 {0.88192126434835505,+0.47139673682599764},	// -20
		 {0.89322430119551532,+0.44961132965460654},	// -19
		 {0.90398929312344334,+0.42755509343028208},	// -18
		 {0.91420975570353069,+0.40524131400498986},	// -17
		 {0.92387953251128674,+0.38268343236508978},	// -16
		 {0.93299279883473896,+0.35989503653498811},	// -15
		 {0.94154406518302081,+0.33688985339222005},	// -14
		 {0.94952818059303667,+0.31368174039889152},	// -13
		 {0.95694033573220882,+0.29028467725446233},	// -12
		 {0.96377606579543984,+0.26671275747489837},	// -11
		 {0.97003125319454397,+0.24298017990326387},	// -10
		 {0.97570213003852857,+0.2191012401568698},		// -09
		 {0.98078528040323043,+0.19509032201612825},	// -08
		 {0.98527764238894122,+0.17096188876030122},	// -07
		 {0.98917650996478101,+0.14673047445536175},	// -06
		 {0.99247953459870997,+0.1224106751992162},		// -05
		 {0.99518472667219693,+0.098017140329560604},	// -04
		 {0.99729045667869021,+0.073564563599667426},	// -03
		 {0.99879545620517241,+0.049067674327418015},	// -02
		 {0.99969881869620425,+0.024541228522912288},	// -01
		 {1.0,+0.0},									// 00
		 {0.99969881869620425,-0.024541228522912288},	// 01
		 {0.99879545620517241,-0.049067674327418015},	// 02
		 {0.99729045667869021,-0.073564563599667426},	// 03
		 {0.99518472667219693,-0.098017140329560604},	// 04
		 {0.99247953459870997,-0.1224106751992162},		// 05
		 {0.98917650996478101,-0.14673047445536175},	// 06
		 {0.98527764238894122,-0.17096188876030122},
		 {0.98078528040323043,-0.19509032201612825},
		 {0.97570213003852857,-0.2191012401568698},
		 {0.97003125319454397,-0.24298017990326387},
		 {0.96377606579543984,-0.26671275747489837},
		 {0.95694033573220882,-0.29028467725446233},
		 {0.94952818059303667,-0.31368174039889152},
		 {0.94154406518302081,-0.33688985339222005},
		 {0.93299279883473896,-0.35989503653498811},
		 {0.92387953251128674,-0.38268343236508978},
		 {0.91420975570353069,-0.40524131400498986},
		 {0.90398929312344334,-0.42755509343028208},
		 {0.89322430119551532,-0.44961132965460654},
		 {0.88192126434835505,-0.47139673682599764},
		 {0.87008699110871146,-0.49289819222978404},
		 {0.85772861000027212,-0.51410274419322166},
		 {0.84485356524970712,-0.53499761988709715},
		 {0.83146961230254524,-0.55557023301960218},
		 {0.81758481315158371,-0.57580819141784534},
		 {0.80320753148064494,-0.59569930449243336},
		 {0.78834642762660623,-0.61523159058062682},
		 {0.77301045336273699,-0.63439328416364549},
		 {0.75720884650648457,-0.65317284295377676},
		 {0.74095112535495922,-0.67155895484701833},
		 {0.724247082951467,-0.68954054473706683},
		 {0.70710678118654757,-0.70710678118654757},
		 {0.68954054473706694,-0.72424708295146689},
		 {0.67155895484701833,-0.74095112535495911},
		 {0.65317284295377687,-0.75720884650648457},
		 {0.63439328416364549,-0.77301045336273688},
		 {0.61523159058062682,-0.78834642762660623},
		 {0.59569930449243347,-0.80320753148064483},
		 {0.57580819141784534,-0.81758481315158371},
		 {0.55557023301960229,-0.83146961230254524},
		 {0.53499761988709726,-0.84485356524970701},
		 {0.51410274419322166,-0.85772861000027212},
		 {0.49289819222978409,-0.87008699110871135},
		 {0.47139673682599781,-0.88192126434835494},
		 {0.4496113296546066,-0.89322430119551532},
		 {0.4275550934302822,-0.90398929312344334},
		 {0.40524131400498986,-0.91420975570353069},
		 {0.38268343236508984,-0.92387953251128674},
		 {0.35989503653498828,-0.93299279883473885},
		 {0.33688985339222005,-0.94154406518302081},
		 {0.31368174039889157,-0.94952818059303667},
		 {0.29028467725446233,-0.95694033573220894},
		 {0.26671275747489842,-0.96377606579543984},
		 {0.24298017990326398,-0.97003125319454397},
		 {0.21910124015686977,-0.97570213003852857},
		 {0.19509032201612833,-0.98078528040323043},
		 {0.17096188876030136,-0.98527764238894122},
		 {0.14673047445536175,-0.98917650996478101},
		 {0.12241067519921628,-0.99247953459870997},
		 {0.09801714032956077,-0.99518472667219682},
		 {0.073564563599667454,-0.99729045667869021},
		 {0.049067674327418126,-0.99879545620517241},
		 {0.024541228522912264,-0.99969881869620425}};

static void coefs_calib_measurement_cb(target_group_p tgg);
static void print_double_cmplx(const char* title, double_cmplx_p fcmpx, uint16_t order);

static CAL_OPT calib_opt = CAL_OPT_INVALID;
static float calibrating_angle = 0.0f;
static event_proc_p calib_cb = NULL;
static coefs_data_p coefs= NULL;
static void(*coefs_pars_set)(void) = NULL;

static void(*set_aoa_sft)(float,float) = NULL;
static uint8_t calib_retry_cnt;
static float aoa_angle_sum,aoa_vangle_sum;
static float max_angle,max_vangle;
static float min_angle,min_vangle;
static float calib_iron_range;
static calib_iron_data_p calib_iron_p= NULL;
static tram_value_t cmplx_mul_doubles_scale(double_cmplx_p val1, double_cmplx_p val2, int scale)
{
	tram_value_t vali;
	vali.re = (int16_t)((val1->re*val2->re-val1->im*val2->im) * scale + 0.49);
	vali.im = (int16_t)((val1->re*val2->im + val1->im*val2->re) * scale + 0.49);
	return vali;
}

static float_cmplx_t cmplx_mul_doubles_to_float(double_cmplx_p v1, double_cmplx_p v2)
{
	float_cmplx_t r;
	r.re = v1->re*v2->re-v1->im*v2->im;
	r.im = v1->re*v2->im + v1->im*v2->re;
	return r;
}

static complex24_t cmplx_mul_float_int_to_int(float_cmplx_p v1, complex24_p v2)
{
	complex24_t r;
	float v2re = v2->re, v2im = v2->im;
	r.re = (int)(v1->re*v2re-v1->im*v2im);
	r.im = (int)(v1->re*v2im + v1->im*v2re);
	return r;
}

static void coefs_spt_windows_set(void)
{
	SPT_mem(SPT_DATA_PACK_16REAL_WRITE, sizeof(rv_cmps_data.win512)/8,
			TRAM_WINDOW_512, (uint32_t)rv_cmps_data.win512);
	SPT_mem(SPT_DATA_PACK_16REAL_WRITE, sizeof(rv_cmps_data.win256)/8,
			TRAM_WINDOW_256, (uint32_t)rv_cmps_data.win256);
	SPT_mem(SPT_DATA_PACK_16REAL_WRITE, sizeof(rv_cmps_data.win128)/8,
			TRAM_WINDOW_128, (uint32_t)rv_cmps_data.win128);
}
static void music_table_set(rv_cmps_data_p rvcmps){
	int i,j,ron;
		PRINTF("music_table_set\n");
	for(i=0;i<200;++i){
		#ifdef ENABLE_SWT
	    clear_SWT0_counter();
	    #endif
	    fs8x_wd_handle(fs8xNormal);
		for(j=0,ron=0X800000;j<8;++j,ron=ron>>1){
			if(ron & coefs->opts_aoa){
				rvcmps->music_table[i][j].re = cos(PI * coefs->maps_ant[j] * sin(0.01745329 * ((float)i - 100) / 5));
				rvcmps->music_table[i][j].im = sin(PI * coefs->maps_ant[j] * sin(0.01745329 * ((float)i - 100) / 5));
			}else{
				rvcmps->music_table[i][j].re = 0;
				rvcmps->music_table[i][j].im = 0;
			}
		}
	}
}
static void coefs_windows_set(rv_cmps_data_p rvcmps)
{
	if (rvcmps == NULL)
		return;

	int count = 0, N=SAMPLES_PER_CHIRP ;
	double*	wins = spt_work_space_get();
	window_get(coefs->win_types[WIN_IDX_RANGE], N, wins, coefs->win_factors[WIN_IDX_RANGE]);
	while(count < N){
		rvcmps->win512[count] = wins[count]*DEFAULT_SCALE_VALUE;
		count++;
	}

	count = 0, N=CHIRPS_PER_FRAME*2;
	window_get(coefs->win_types[WIN_IDX_DOPPLER], N, wins,coefs->win_factors[WIN_IDX_DOPPLER]);
	while(count < N){
		rvcmps->win256[count] = wins[count]*DEFAULT_SCALE_VALUE;
		count++;
	}

	count = 0, N=CHIRPS_PER_FRAME;
	window_get(coefs->win_types[WIN_IDX_DOPPLER], N, wins, coefs->win_factors[WIN_IDX_DOPPLER]);
	while(count < N){
		rvcmps->win128[count] = wins[count]*DEFAULT_SCALE_VALUE;
		count++;
	}
}

static void coefs_calib_from_cmplx(complex24_p cx)
{
	uint16_t i;
	float opt_calib_rad = RADIAN_OF_DEGREE(calibrating_angle);
	double base, phs;
	double_cmplx_p rvals=coefs->coefs;

	PRINTF("clb:cx[");
	for (i = 0; i < 8; i++) {
		PRINTF("%ld+%ldj,", cx[i].re, cx[i].im);
	}
	PRINTF("]\n");

	base = atan2((double)cx->im, (double)cx->re);
	for(i = 0; i < 8; i++){
		phs = base - atan2((double)cx[i].im, (double)cx[i].re);
		rvals[i].re = cos(phs + sin(opt_calib_rad) * PI * coefs->maps_ant[i]);
		rvals[i].im = sin(phs + sin(opt_calib_rad) * PI * coefs->maps_ant[i]);
	}
}

static void default_calib_cb(void* d)
{
	if (!d)
		PRINTF("clb: calibtation falied!\n");
	else {
		target_group_p tgg = (target_group_p)d;
		target_p tg = tgg->targets;
		int idx=0;
		while(tg < (tgg->targets+tgg->tcnt)){
			if(tg->aoaidx != AOAIDX_INVALID && tg->velocity == 0)
				PRINTF("e%d,a=%.4f,v=%d,r=%.2f,h:%d,m:%.1f\n",idx++,DEGREE_OF_RADIAN(aoaidx_asin(tg->aoaidx)),tg->velocity,(float)tg->range*tgg->runit,
						tg->vangle,spt_log2db(tg->mag_log2));
			tg++;
		}
	}
}

void coefs_calib_start(float clb, float angle, CAL_OPT opt,void (*done_cb)(float,float))
{
    uint8_t i;
	complex24_t cx[8];
	
	calibrating_angle = angle;
	calib_opt=opt;
		
	if(CAL_OPT_CIRCUIT==calib_opt){
	    set_tef810x_production_mode(kPRODUCTION_MODE);
	    tef_zero_calibration(0, zero_angle_calibration_bw);    //use zero calibration bandwidth value.
		frame_rng_aoa_set(0,0,0,0,0);
		frame_set_hsft(0,0);
	    //reset cmplx for MUSIC
		for(i=0;i<8;i++){
			cx[i].re=1;
			cx[i].im=0;
		}
		coefs_calib_from_cmplx(cx);
		coefs_cmps_set(COEFS_CMPS_CALIB_ONLY);
	}else{
		calib_retry_cnt=0;
		aoa_angle_sum=0;
		aoa_vangle_sum=0;
		max_angle=-180;
		max_vangle=-180;
		min_angle=180;
		min_vangle=180;
		calib_iron_range=clb;
		set_aoa_sft=done_cb;
	}
	spt_doppler_get(FRAME_CTX_IDX_LONG, clb, (event_proc_p)coefs_calib_measurement_cb);
}

static void coefs_calib_cmplx(complex24_p cx)
{
	if(cx == NULL){
		PRINTF("clb: can't set coefs with NULL complexes!\n");
		return;
	}

	coefs_calib_from_cmplx(cx);
	coefs_pars_set();
	coefs_cmps_set(COEFS_CMPS_CALIB_ONLY);
}


#define COEFS_ID					FOURCC('c','o','e','f')
#define COEFS_VERSION				0x0101
const int8_t fft16_winidx[16] = {0,4,8,12,1,5,9,13,2,6,10,14,3,7,11,15};
void coefs_cmps_set(COEFS_CMPS_SET_MODE_E mode)
{
	uint16_t 		idx, i, on, woffs;
	double_cmplx_p 	velo_cmps = (double_cmplx_p)velo_cmps_negative, rvals = coefs->coefs;
	tram_value_t	tv[4];
	rv_cmps_data_p 	rvcmps = &rv_cmps_data;
	double_cmplx_p 	neg_cmps = (double_cmplx_p)spt_work_space_get();

	/* 0 degree =>aoa_p, aoa_n and bfms[0] */
	print_double_cmplx("coefs", rvals, TOTAL_RX_ACTIVES);

	PRINTF("coef: %08lX, %04X\n",rv_cmps_data.coefs_id,rv_cmps_data.version);
	if(rv_cmps_data.coefs_id == COEFS_ID && mode == COEFS_CMPS_INIT &&
			rv_cmps_data.version == COEFS_VERSION)
		goto _cal_coefs_done_;


    if(mode != COEFS_CMPS_WIN_ONLY)
    {
    	memset(rvcmps, 0, offsetof(rv_cmps_data_t, win512));
	    // aoa_near
	    for(i=0, on=0x8000; i < RX_ACTIVES; i++, on=on>>1){
		    tv[i] = cmplx_mul_doubles_scale(&rvals[i], &rvals[0], DEFAULT_SCALE_VALUE);
		    rvcmps->aoa_near[i].re = rvals[i].re;
		    rvcmps->aoa_near[i].im = rvals[i].im;
		    if(coefs->opts_fft3d & on){
			    rvcmps->fft3d_near[fft16_winidx[coefs->maps_ant[i]]] = tv[i];
		    }
	    }

	    // aoa_p, aoa_n
	    for(idx=0; idx < CHIRPS_PER_FRAME; idx++) {
			#ifdef ENABLE_SWT
	    	clear_SWT0_counter();
	    	#endif
	    	fs8x_wd_handle(fs8xNormal);
		    on = 0x80;
		    for(i = 0; i < RX_ACTIVES; i++) {
			    rvcmps->aoa_long[idx][i] = rvcmps->aoa_near[i];
			    rvcmps->aoa_long[idx+CHIRPS_PER_FRAME][i] = rvcmps->aoa_near[i];

			    if(on & coefs->opts_fft3d) {
				    if((0x80&coefs->opts_fft3d) == 0) {
					    woffs = fft16_winidx[coefs->maps_ant[i]-coefs->maps_ant[1]];
					    rvcmps->fft3d_long[idx][0][woffs] = tv[i];
					    rvcmps->fft3d_long[idx][1][woffs] = tv[i];
				    }
				    else {
					    woffs = fft16_winidx[coefs->maps_ant[i]];
					    rvcmps->fft3d_long[idx][0][woffs] = tv[i];
					    rvcmps->fft3d_long[idx][1][woffs] = tv[i];
				    }
			    }
			    on = on>>1;
		    }

		    neg_cmps[idx].im = 0-velo_cmps[idx].im;
		    neg_cmps[idx].re = 0-velo_cmps[idx].re;

		    for(i = RX_ACTIVES; i < TOTAL_RX_ACTIVES; i++) {
			    if(idx < (CHIRPS_PER_FRAME/2)) {
				    rvcmps->aoa_long[idx+(CHIRPS_PER_FRAME/2)][i] = cmplx_mul_doubles_to_float(&velo_cmps[idx], &rvals[i]);
				    rvcmps->aoa_long[idx+CHIRPS_PER_FRAME+(CHIRPS_PER_FRAME/2)][i] = cmplx_mul_doubles_to_float(&neg_cmps[idx], &rvals[i]);
			    }
			    else {
				    rvcmps->aoa_long[idx+(CHIRPS_PER_FRAME/2)][i] = cmplx_mul_doubles_to_float(&velo_cmps[idx], &rvals[i]);
				    rvcmps->aoa_long[idx-(CHIRPS_PER_FRAME/2)][i] = cmplx_mul_doubles_to_float(&neg_cmps[idx], &rvals[i]);
			    }

			    if(on & coefs->opts_fft3d) {
				    if((0x80&coefs->opts_fft3d) == 0) {
					    woffs = fft16_winidx[coefs->maps_ant[i]-coefs->maps_ant[1]];
					    rvcmps->fft3d_long[idx][0][woffs] = cmplx_mul_doubles_scale(&velo_cmps[idx], &rvals[i], DEFAULT_SCALE_VALUE);
					    rvcmps->fft3d_long[idx][1][woffs] = cmplx_mul_doubles_scale(&neg_cmps[idx], &rvals[i], DEFAULT_SCALE_VALUE);
				    }
				    else {
					    woffs = fft16_winidx[coefs->maps_ant[i]];
					    rvcmps->fft3d_long[idx][0][woffs] = cmplx_mul_doubles_scale(&velo_cmps[idx], &rvals[i], DEFAULT_SCALE_VALUE);
					    rvcmps->fft3d_long[idx][1][woffs] = cmplx_mul_doubles_scale(&neg_cmps[idx], &rvals[i], DEFAULT_SCALE_VALUE);
				    }
			    }
			    on = on >> 1;
		    }
	    }

#ifdef ENABLE_SWT
        clear_SWT0_counter();
#endif
		fs8x_wd_handle(fs8xNormal);

        for(i=0,on=0x80, idx=0x8000; i<TOTAL_RX_ACTIVES; i++,on=on>>1, idx=idx>>1) {
    	    if(idx & coefs->opts_fft3d){
    		    rvcmps->fft3d_amap4[i].re = coefs->maps_ant[i]*8;
    	    }
    	    else {
    		    rvcmps->fft3d_amap4[i].re = 0x7FFF;
    		    rvcmps->fft3d_amap4[i].im = 0x7FFF;
    	    }

    	    if(on & coefs->opts_fft3d){
    		    if((coefs->opts_fft3d & 0x80) == 0)
    			    rvcmps->fft3d_amap8[i].re = (coefs->maps_ant[i]-coefs->maps_ant[1])*8;
    		    else
    			    rvcmps->fft3d_amap8[i].re = coefs->maps_ant[i]*8;
    	    }
    	    else {
    		    rvcmps->fft3d_amap8[i].re = 0x7FFF;
    		    rvcmps->fft3d_amap8[i].im = 0x7FFF;
    	    }
        }
        music_table_set(rvcmps);
    }
    if(mode != COEFS_CMPS_CALIB_ONLY)
    {
    	//memset(rvcmps->win512, 0, sizeof(rv_cmps_data_t)-offsetof(rv_cmps_data_t, win512));
	    coefs_windows_set(rvcmps);
	}

	rvcmps->coefs_id = COEFS_ID;
	rvcmps->version = COEFS_VERSION;

_cal_coefs_done_:
	SPT_mem(SPT_DATA_PACK_16CMPX_WRITE, (sizeof(rvcmps->fft3d_near)+sizeof(rvcmps->fft3d_amap4)+sizeof(rvcmps->fft3d_amap8))/8,
			TRAM_FFT3D_4R, (uint32_t)rv_cmps_data.fft3d_near);

	coefs_spt_windows_set();
	IPC_SEND_MSG_Z71(MSG_MUSIC_COEFS, (void*)rv_cmps_data.music_table, 0);
	PRINTF("clb: coefs set done\n");
}

static void print_double_cmplx(const char* title, double_cmplx_p fcmpx, uint16_t order)
{
	uint16_t i;
	PRINTF("%s:[", title);
	for (i = 0; i<order; i++)
		PRINTF("%.5f+%.5fj,", fcmpx[i].re, fcmpx[i].im);
	PRINTF("]\n");
}

void print_float_cmplx(const char* title, float_cmplx_p fcmpx, uint16_t order)
{
	uint16_t i;
	if(title != NULL)
		PRINTF("%s", title);

	PRINTF(":[");
	for (i = 0; i<order; i++)
		PRINTF("%.5f+%.5fj,", fcmpx[i].re, fcmpx[i].im);
	PRINTF("]\n");
}

static void calib_iron_get_angle(target_p tg);
static void iron_get_angle(void)
{
    uint8_t res;
    res=frame_measurements_get_by_rng_for_calib_iron(FRAME_CTX_IDX_LONG,calib_iron_range, (event_proc_p)calib_iron_get_angle);
    if (res != MEAS_ST_READY) {
		PRINTF("calib-iron failed\n");
	}
}

static void calib_iron_get_angle(target_p tg)
{
	float angle = DEGREE_OF_RADIAN(aoaidx_asin(tg->aoaidx));
    PRINTF("clb before: a=%.4f,va=%d,v=%d\n", angle, tg->vangle, tg->velocity);
    if(max_angle<angle){
        max_angle=angle;
    }
    if(min_angle>angle){
        min_angle=angle;
    }
    aoa_angle_sum+=angle;
    
    if(max_vangle<tg->vangle){
        max_vangle=tg->vangle;
    }
    if(min_vangle>tg->vangle){
        min_vangle=tg->vangle;
    }
    aoa_vangle_sum+=tg->vangle;
    
    calib_retry_cnt++;
    if((calib_retry_cnt>calib_iron_p->number_of_measurement)&&(calib_retry_cnt>3)){
        PRINTF("a: max =%.4f, min=%.4f, sum==%.4f, cnt=%d\n", max_angle,min_angle,aoa_angle_sum,calib_retry_cnt);
        PRINTF("Va: max =%.4f, min=%.4f, sum==%.4f\n", max_vangle,min_vangle,aoa_vangle_sum);
        aoa_angle_sum-= max_angle;
        aoa_angle_sum-= min_angle;
        aoa_vangle_sum-= max_vangle;
        aoa_vangle_sum-= min_vangle;
        calib_retry_cnt-=2;
        aoa_angle_sum=aoa_angle_sum/calib_retry_cnt;
        aoa_vangle_sum=aoa_vangle_sum/calib_retry_cnt;
        PRINTF("aoa_angle_sum =%.4f\n", aoa_angle_sum);
        PRINTF("aoa_vangle_sum =%.4f\n", aoa_vangle_sum);
        if(set_aoa_sft!=NULL)
            set_aoa_sft(aoa_angle_sum,aoa_vangle_sum);
    }else{
        put_event("clbi_get_angle", (event_proc_p)iron_get_angle, NULL);
    }
}

static void coefs_calib_measurement_cb(target_group_p tgg)
{
	uint8_t res;
	if(tgg == NULL){
		PRINTF("clb: Err null tggs\n");
		return;
	}

	target_p tg = tgg->targets;
	PRINTF("clb before: a=%.4f,va=%d,v=%d,r=%.2f\n", DEGREE_OF_RADIAN(aoaidx_asin(tg->aoaidx)), tg->vangle,tg->velocity, (float)tg->range*tgg->runit);
	if(CAL_OPT_CIRCUIT==calib_opt){
		coefs_calib_cmplx(tg->cmplx);
		//tg->velocity = VELOCITY_INPUT_PRECISION/2;
		//spt_fft_angle(tgg);
		tgg->state = TGG_ST_READY;
	}else{
		res=frame_measurements_get_by_rng_for_calib_iron(FRAME_CTX_IDX_LONG,calib_iron_range,(event_proc_p)calib_iron_get_angle);
		if (res != MEAS_ST_READY) {
		    PRINTF("calib-iron failed\n");
	    }
		return;
	}

	if(calib_cb != NULL){
		res=frame_measurements_get_by_rng_for_calib(FRAME_CTX_IDX_LONG, (float)tg->range*tgg->runit, calib_cb);
		if (res != MEAS_ST_READY) {
		    PRINTF("calib failed\n");
	    }
		calib_cb = NULL;
	}
	else
		spt_long_start(default_calib_cb);
}

// argument range shall be in cm
int coefs_calib_ranged_measurement(float clb_angle, float clb_range, event_proc_p cb)
{
	uint8_t i;
	complex24_t cx[8];
	
	calib_opt=CAL_OPT_CIRCUIT;
	calib_cb = cb;
	calibrating_angle = clb_angle;
	set_tef810x_production_mode(kPRODUCTION_MODE);
	tef_zero_calibration(0, zero_angle_calibration_bw);    //use zero calibration bandwidth value.
	frame_rng_aoa_set(0,0,0,0,0);
	frame_set_hsft(0,0);
	//reset cmplx for MUSIC
	for(i=0;i<8;i++)
	{
	    cx[i].re=1;
	    cx[i].im=0;
	}
	coefs_calib_from_cmplx(cx);
	coefs_cmps_set(COEFS_CMPS_CALIB_ONLY);
	
	return spt_doppler_get(FRAME_CTX_IDX_LONG, clb_range, (event_proc_p)coefs_calib_measurement_cb);
}

uint8_t coefs_overlapped_rx_get(void)
{
	if(coefs->maps_ant[3] == coefs->maps_ant[4])
		return coefs->maps_ant[3];
	else
		return 0;
}

float coefs_phase_differ(complex24_p r4, complex24_p r5)
{
	float real, imag;
	real = (float)r4->re*(float)r5->re+(float)r4->im*(float)r5->im;
	imag = (float)r4->im*(float)r5->re-(float)r4->re*(float)r5->im;
	return (float)atan2(imag, real);
}

void coefs_target_cmplx_cmps(target_p tg, target_aoa_data_p tad, int order)
{
	uint16_t ron, i;
	float_cmplx_p velo_coefs;
	complex24_t cmplx_val;

	if (order == TOTAL_RX_ACTIVES) {
		velo_coefs = rv_cmps_data.aoa_long[tg->velocity];
		for(i=0,ron=0x80; i<order; i++,ron=ron>>1){
			cmplx_val = cmplx_mul_float_int_to_int(&velo_coefs[i], &tg->cmplx[i]);
			if(ron & coefs->opts_aoa)
				tad->t1t2[coefs->maps_ant[i]] = cmplx_val;

			if(i<RX_ACTIVES)
				tad->t1[coefs->maps_ant[i]] = cmplx_val;
			else
				tad->t2[coefs->maps_ant[i]] = cmplx_val;
			tg->cmplx[i] = cmplx_val;
		}
	}
	else {
		velo_coefs = rv_cmps_data.aoa_near;
		for(i=0,ron=0x8000; i<order; i++,ron=ron>>1){
			if(ron & coefs->opts_aoa){
				tad->t1t2[coefs->maps_ant[i]] = cmplx_mul_float_int_to_int(&velo_coefs[i], &tg->cmplx[i]);
			}
		}
	}
}

void print_cmpsed_cmplx(target_aoa_data_p tad, int order)
{
	PRINTF("tad(%08lX):[(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj)]",(uint32_t)tad,
			tad->t1t2[0].re,tad->t1t2[0].im,tad->t1t2[1].re,tad->t1t2[1].im,
			tad->t1t2[2].re,tad->t1t2[2].im,tad->t1t2[3].re,tad->t1t2[3].im,
			tad->t1t2[4].re,tad->t1t2[4].im,tad->t1t2[5].re,tad->t1t2[5].im,
			tad->t1t2[6].re,tad->t1t2[6].im,tad->t1t2[7].re,tad->t1t2[7].im,tad->t1t2[8].re,tad->t1t2[8].im);
	if(order == TOTAL_RX_ACTIVES){
		PRINTF("[(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj)]\n",
				tad->t1t2[9].re,tad->t1t2[9].im,tad->t1t2[10].re,tad->t1t2[10].im,
				tad->t1t2[11].re,tad->t1t2[11].im,tad->t1t2[12].re,tad->t1t2[12].im,
				tad->t1t2[13].re,tad->t1t2[13].im,tad->t1t2[14].re,tad->t1t2[14].im,
				tad->t1t2[15].re,tad->t1t2[15].im,tad->t1t2[16].re,tad->t1t2[16].im);

		PRINTF("tad(t1):[(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj)]\n",
				tad->t1[coefs->maps_ant[0]].re,tad->t1[coefs->maps_ant[0]].im,
				tad->t1[coefs->maps_ant[1]].re,tad->t1[coefs->maps_ant[1]].im,
				tad->t1[coefs->maps_ant[2]].re,tad->t1[coefs->maps_ant[2]].im,
				tad->t1[coefs->maps_ant[3]].re,tad->t1[coefs->maps_ant[3]].im);

		PRINTF("tad(t2):[(%ld+%ldj),(%ld+%ldj),(%ld+%ldj),(%ld+%ldj)]\n",
				tad->t2[coefs->maps_ant[4]].re,tad->t2[coefs->maps_ant[4]].im,
				tad->t2[coefs->maps_ant[5]].re,tad->t2[coefs->maps_ant[5]].im,
				tad->t2[coefs->maps_ant[6]].re,tad->t2[coefs->maps_ant[6]].im,
				tad->t2[coefs->maps_ant[7]].re,tad->t2[coefs->maps_ant[7]].im);

		PRINTF("tad(misc):tv=[(%.f,%.fj)(%.f,%.fj)],pv=[%08lX,%08lX]",
				tad->tv[0].re,tad->tv[0].im, tad->tv[1].re, tad->tv[1].im,
				tad->pv[0][0],tad->pv[1][0]);
	}
	PRINTF("\n");
}

static void coefs_tester(char** args, int count)
{
    if (count < 2)
        return;

	if (count >= 5) {
		WIN_TYPE_E type = strtoul(args[1], 0, 16);
		uint32_t out = strtoul(args[2], 0, 16);
		int16_t N = strtoul(args[3], 0, 16);
		float factor = strtof(args[4], 0);
		int16_t S=1;

		if(count >=6 )
			S = strtoul(args[5], 0, 16);

		window_context_p wctx = window_ctx_get(type-1);
		if(wctx) {
			double *res=(double*)out;
			PRINTF("win: %s(%d,%08lX,%.2f)\n",wctx->name, N, out, factor);
			console_flush();

			wctx->proc(res, N, factor);
			PRINTF("win:%s,%04X,%f listing..\n", wctx->name, N, factor);
			count = N;
			while(count>0) {
				PRINTF("%08lX %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n",
						(uint32_t)res,res[0],res[1],res[2],res[3],res[4],res[5],res[6],res[7]);
				res += 8;
				count -= 8;
			}

#ifdef ENABLE_SWT
			clear_SWT0_counter();
#endif
			if(S > 1){
				res = (double*)out;
				count = N;
				PRINTF("\nwin:%s,%04X,%f listing with S=%d..\n", wctx->name, N, factor, S);
				while(count>0) {
					PRINTF("%08lX %04X %04X %04X %04X %04X %04X %04X %04X\n",
							(uint32_t)res,(uint16_t)(res[0]*S),(uint16_t)(res[1]*S),(uint16_t)(res[2]*S),
							(uint16_t)(res[3]*S),(uint16_t)(res[4]*S),(uint16_t)(res[5]*S),(uint16_t)(res[6]*S),
							(uint16_t)(res[7]*S));
					res += 8;
					count -= 8;
				}
			}
		}
	}
	else if(count >= 3) {
		int dat = (int)strtol(args[2], NULL, 10);
		if(!strcmp(args[1], "aoa")){
			if(dat >= CHIRPS_PER_FRAME || dat < (-CHIRPS_PER_FRAME))
				return;

			PRINTF("aoa[%d]", dat);
			print_float_cmplx(NULL, rv_cmps_data.aoa_long[dat+CHIRPS_PER_FRAME], TOTAL_RX_ACTIVES);
		}
		else if(!strcmp(args[1], "tad")) {
			target_aoa_data_p tad=(target_aoa_data_p)TARGET_AOA_DATA;
			if(dat < MAX_COUNT_OF_TARGET)
				tad += dat;

			if(count > 3){
				int end = (int)strtol(args[3], NULL, 10);
				while(dat < end){
					print_cmpsed_cmplx(tad+dat, TOTAL_RX_ACTIVES);
					dat++;
				}
			}
			else
				print_cmpsed_cmplx(tad, TOTAL_RX_ACTIVES);
		}
	}

	else if(!strcmp(args[1],"fft3d")){
		tram_value_p tm=rv_cmps_data.fft3d_long[0][0];
		count = 0;
		while(count < CHIRPS_PER_FRAME){
			PRINTF("vel_i(%d):[(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj)",count,
					tm[0].re, tm[0].im, tm[1].re, tm[1].im, tm[2].re, tm[2].im, tm[3].re, tm[3].im, tm[4].re, tm[4].im,
					tm[5].re, tm[5].im, tm[6].re, tm[6].im, tm[7].re, tm[7].im);
			PRINTF("(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj)]\n",
					tm[8].re, tm[8].im, tm[9].re, tm[9].im, tm[10].re, tm[10].im, tm[11].re, tm[11].im, tm[12].re, tm[12].im,
					tm[13].re, tm[13].im, tm[14].re, tm[14].im, tm[15].re, tm[15].im);
			PRINTF("vel_o(%d):[(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj)",count,
					tm[16].re, tm[16].im, tm[17].re, tm[17].im, tm[18].re, tm[18].im, tm[19].re, tm[19].im, tm[20].re, tm[20].im,
					tm[21].re, tm[21].im, tm[22].re, tm[22].im, tm[23].re, tm[23].im);
			PRINTF("(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj)]\n",
					tm[24].re, tm[24].im, tm[25].re, tm[25].im, tm[26].re, tm[26].im, tm[27].re, tm[27].im, tm[28].re, tm[28].im,
					tm[29].re, tm[29].im, tm[30].re, tm[30].im, tm[31].re, tm[31].im);

			tm += (FFT3D_BINS*2);
			count++;
		}
	}

	else if(!strcmp(args[1],"aoas")){
		float_cmplx_p cfp=rv_cmps_data.aoa_long[0];
		count = -CHIRPS_PER_FRAME;
		while(count < CHIRPS_PER_FRAME){
			PRINTF("velos(%d):[(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj),(%.4f+%.4fj)]\n",count,
					cfp[0].re, cfp[0].im, cfp[1].re, cfp[1].im, cfp[2].re, cfp[2].im, cfp[3].re, cfp[3].im, cfp[4].re, cfp[4].im,
					cfp[5].re, cfp[5].im, cfp[6].re, cfp[6].im, cfp[7].re, cfp[7].im);

			cfp += (TOTAL_RX_ACTIVES);
			count++;
		}
	}

	else if(!strcmp(args[1], "near")) {
		float_cmplx_p cfp=rv_cmps_data.aoa_near;
		tram_value_p tm=rv_cmps_data.fft3d_near;
		PRINTF("fft3d_near:[(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj),(%d+%dj)]\n",
				tm[0].re, tm[0].im, tm[1].re, tm[1].im, tm[2].re, tm[2].im, tm[3].re, tm[3].im, tm[4].re, tm[4].im,tm[5].re, tm[5].im, tm[6].re, tm[6].im, tm[7].re, tm[7].im,
				tm[8].re, tm[8].im, tm[9].re, tm[9].im, tm[10].re, tm[10].im, tm[11].re, tm[11].im, tm[12].re, tm[12].im, tm[13].re, tm[13].im, tm[14].re, tm[14].im, tm[15].re, tm[15].im);

		PRINTF("aoa_near:[(%.5f+%.5fj),(%.5f+%.5fj),(%.5f+%.5fj),(%.5f+%.5fj)]\n",cfp[0].re, cfp[0].im, cfp[1].re, cfp[1].im, cfp[2].re, cfp[2].im, cfp[3].re, cfp[3].im);
	}

	else if(!strcmp(args[1],"wins")){

	}

#ifdef AOAIDXS_SET
	else if(!strcmp(args[1],"aoaidx")) {
		aoaidxs_table_p tables = &rv_cmps_data.aoaidxs;
    	coefs_aoa_idxs_set(tables);
		for(int idx=0; idx < BINS_OF_AOA_FFT; idx = idx+16){
			PRINTF("AOAIDX(%d):\n",idx);
			PRINTF("ASIN=[%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f]\n",
					tables->asin[idx],tables->asin[idx+1],tables->asin[idx+2],tables->asin[idx+3],
					tables->asin[idx+4],tables->asin[idx+5],tables->asin[idx+6],tables->asin[idx+7],
					tables->asin[idx+8],tables->asin[idx+9],tables->asin[idx+10],tables->asin[idx+11],
					tables->asin[idx+12],tables->asin[idx+13],tables->asin[idx+14],tables->asin[idx+15]);
			PRINTF("SIN= [%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f]\n",
					tables->sin[idx],tables->sin[idx+1],tables->sin[idx+2],tables->sin[idx+3],
					tables->sin[idx+4],tables->sin[idx+5],tables->sin[idx+6],tables->sin[idx+7],
					tables->sin[idx+8],tables->sin[idx+9],tables->sin[idx+10],tables->sin[idx+11],
					tables->sin[idx+12],tables->sin[idx+13],tables->sin[idx+14],tables->sin[idx+15]);
			PRINTF("COS= [%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f,%.5f]\n",
					tables->cos[idx],tables->cos[idx+1],tables->cos[idx+2],tables->cos[idx+3],
					tables->cos[idx+4],tables->cos[idx+5],tables->cos[idx+6],tables->cos[idx+7],
					tables->cos[idx+8],tables->cos[idx+9],tables->cos[idx+10],tables->cos[idx+11],
					tables->cos[idx+12],tables->cos[idx+13],tables->cos[idx+14],tables->cos[idx+15]);
		}
	}
#endif

	else if(!strcmp(args[1],"map"))
		PRINTF("cmps: alr=%08lXh,asr=%08lXh,flr=%08lXh,fsr=%08lXh,win=%08lXh\n", (uint32_t)rv_cmps_data.aoa_long, (uint32_t)rv_cmps_data.aoa_near,
				(uint32_t)rv_cmps_data.fft3d_long, (uint32_t)rv_cmps_data.fft3d_near, (uint32_t)rv_cmps_data.win512);

	else
		PRINTF("usage: win type(0/1) out(addr) N(bins) factor(float)\n");
}


void coefs_init(coefs_data_p cfs, void(*pset)(void))
{
	coefs = cfs;
	coefs_pars_set = pset;
	coefs_cmps_set(COEFS_CMPS_ALL);
	IPC_SEND_MSG_Z71(MSG_AOAIDXS_TABLE, (void*)&aoaidxs_table, 0);
	console_command_reg("coefs", coefs_tester);
}

void calib_iron_init(calib_iron_data_p cfs)
{
	calib_iron_p = cfs;
}
